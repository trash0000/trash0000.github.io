/*
	Leaflet.RSWE, Room Sketches Web Editor, a plugin that adds ability to draw and edit rooms and indoo sketches to Leaflet powered maps.
	(c) 2016, Alexey Soloviev
	https://github.com/trash0000/Leaflet.RSWE
	http://leafletjs.com
	https://github.com/trash0000
*/
!function(t,e,i){!function(){L.Control.FullScreen=L.Control.extend({options:{position:"topleft",title:"Full Screen",titleCancel:"Exit Full Screen",forceSeparateButton:!1,forcePseudoFullscreen:!1},onAdd:function(t){var e,i="leaflet-control-zoom-fullscreen",n="";return e=t.zoomControl&&!this.options.forceSeparateButton?t.zoomControl._container:L.DomUtil.create("div","leaflet-bar"),this.options.content?n=this.options.content:i+=" fullscreen-icon",this._createButton(this.options.title,i,n,e,this.toggleFullScreen,this),this._map.on("enterFullscreen exitFullscreen",this._toggleTitle,this),e},_createButton:function(t,n,o,s,a,r){return this.link=L.DomUtil.create("a",n,s),this.link.href="#",this.link.title=t,this.link.innerHTML=o,L.DomEvent.addListener(this.link,"click",L.DomEvent.stopPropagation).addListener(this.link,"click",L.DomEvent.preventDefault).addListener(this.link,"click",a,r),L.DomEvent.addListener(s,i.fullScreenEventName,L.DomEvent.stopPropagation).addListener(s,i.fullScreenEventName,L.DomEvent.preventDefault).addListener(s,i.fullScreenEventName,this._handleEscKey,r),L.DomEvent.addListener(e,i.fullScreenEventName,L.DomEvent.stopPropagation).addListener(e,i.fullScreenEventName,L.DomEvent.preventDefault).addListener(e,i.fullScreenEventName,this._handleEscKey,r),this.link},toggleFullScreen:function(){var t=this._map;t._exitFired=!1,t._isFullscreen?(i.supportsFullScreen&&!this.options.forcePseudoFullscreen?i.cancelFullScreen(t._container):L.DomUtil.removeClass(t._container,"leaflet-pseudo-fullscreen"),t.invalidateSize(),t.fire("exitFullscreen"),t._exitFired=!0,t._isFullscreen=!1):(i.supportsFullScreen&&!this.options.forcePseudoFullscreen?i.requestFullScreen(t._container):L.DomUtil.addClass(t._container,"leaflet-pseudo-fullscreen"),t.invalidateSize(),t.fire("enterFullscreen"),t._isFullscreen=!0)},_toggleTitle:function(){this.link.title=this._map._isFullscreen?this.options.title:this.options.titleCancel},_handleEscKey:function(){var t=this._map;i.isFullScreen(t)||t._exitFired||(t.fire("exitFullscreen"),t._exitFired=!0,t._isFullscreen=!1)}}),L.control.fullscreen=function(t){return new L.Control.FullScreen(t)},L.Map.addInitHook(function(){L.extend(this.options,{fullscreenControl:!0,fullscreenControlOptions:{position:"topleft"}}),this.options.fullscreenControl&&(this.fullscreenControl=L.control.fullscreen(this.options.fullscreenControlOptions),this.addControl(this.fullscreenControl))});var i={supportsFullScreen:!1,isFullScreen:function(){return!1},requestFullScreen:function(){},cancelFullScreen:function(){},fullScreenEventName:"",prefix:""},n="webkit moz o ms khtml".split(" ");if("undefined"!=typeof e.exitFullscreen)i.supportsFullScreen=!0;else for(var o=0,s=n.length;s>o;o++)if(i.prefix=n[o],"undefined"!=typeof e[i.prefix+"CancelFullScreen"]){i.supportsFullScreen=!0;break}i.supportsFullScreen&&(i.fullScreenEventName=i.prefix+"fullscreenchange",i.isFullScreen=function(){switch(this.prefix){case"":return e.fullScreen;case"webkit":return e.webkitIsFullScreen;default:return e[this.prefix+"FullScreen"]}},i.requestFullScreen=function(t){return""===this.prefix?t.requestFullscreen():t[this.prefix+"RequestFullScreen"]()},i.cancelFullScreen=function(){return""===this.prefix?e.exitFullscreen():e[this.prefix+"CancelFullScreen"]()}),"undefined"!=typeof jQuery&&(jQuery.fn.requestFullScreen=function(){return this.each(function(){var t=jQuery(this);i.supportsFullScreen&&i.requestFullScreen(t)})}),t.fullScreenApi=i}(),L.Util=L.extend(L.Util||{},{base64Encode:function(t){var e,i,n,o,s,a,r,l,h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",d=0,p="";do e=t.charCodeAt(d++),i=t.charCodeAt(d++),n=t.charCodeAt(d++),l=e<<16|i<<8|n,o=l>>18&63,s=l>>12&63,a=l>>6&63,r=63&l,p+=h.charAt(o)+h.charAt(s)+h.charAt(a)+h.charAt(r);while(d<t.length);switch(t.length%3){case 1:p=p.slice(0,-2)+"==";break;case 2:p=p.slice(0,-1)+"="}return p}}),L.Curve=L.Path.extend({options:{},initialize:function(t,e){L.setOptions(this,e),this._setPath(t)},getPath:function(){return this._coords},setPath:function(t){return this._setPath(t),this.redraw()},getBounds:function(){return this._bounds},_setPath:function(t){this._coords=t,this._bounds=this._computeBounds()},_computeBounds:function(){for(var t,e,i,n,o,s,a,r,l,h=new L.LatLngBounds,d=0;d<this._coords.length;d++)i=this._coords[d],"string"==typeof i||i instanceof String?e=i:"H"===e?(h.extend([t.lat,i[0]]),t=new L.latLng(t.lat,i[0])):"V"===e?(h.extend([i[0],t.lng]),t=new L.latLng(i[0],t.lng)):"C"===e?(o=new L.latLng(i[0],i[1]),i=this._coords[++d],s=new L.latLng(i[0],i[1]),i=this._coords[++d],a=new L.latLng(i[0],i[1]),h.extend(o),h.extend(s),h.extend(a),a.controlPoint1=o,a.controlPoint2=s,t=a):"S"===e?(s=new L.latLng(i[0],i[1]),i=this._coords[++d],a=new L.latLng(i[0],i[1]),o=t,t.controlPoint2&&(r=t.lat-t.controlPoint2.lat,l=t.lng-t.controlPoint2.lng,o=new L.latLng(t.lat+r,t.lng+l)),h.extend(o),h.extend(s),h.extend(a),a.controlPoint1=o,a.controlPoint2=s,t=a):"Q"===e?(n=new L.latLng(i[0],i[1]),i=this._coords[++d],a=new L.latLng(i[0],i[1]),h.extend(n),h.extend(a),a.controlPoint=n,t=a):"T"===e?(a=new L.latLng(i[0],i[1]),n=t,t.controlPoint&&(r=t.lat-t.controlPoint.lat,l=t.lng-t.controlPoint.lng,n=new L.latLng(t.lat+r,t.lng+l)),h.extend(n),h.extend(a),a.controlPoint=n,t=a):(h.extend(i),t=new L.latLng(i[0],i[1]));return h},getCenter:function(){return this._bounds.getCenter()},_update:function(){this._map&&this._updatePath()},_project:function(){var t,e,i,n;this._points=[];for(var o=0;o<this._coords.length;o++)if(t=this._coords[o],"string"==typeof t||t instanceof String)this._points.push(t),i=t;else{switch(t.length){case 2:n=this._map.latLngToLayerPoint(t),e=t;break;case 1:"H"===i?(n=this._map.latLngToLayerPoint([e[0],t[0]]),e=[e[0],t[0]]):(n=this._map.latLngToLayerPoint([t[0],e[1]]),e=[t[0],e[1]])}this._points.push(n)}},getPathString:function(){return this._project(),this._curvePointsToPath(this._points)},_curvePointsToPath:function(t){var e,i,n="";if(t)for(var o=0;o<t.length;o++)if(e=t[o],"string"==typeof e||e instanceof String)i=e,n+=i;else switch(i){case"H":n+=e.x+" ";break;case"V":n+=e.y+" ";break;default:n+=e.x+","+e.y+" "}return n||"M0 0"}}),L.curve=function(t,e){return new L.Curve(t,e)},L.drawVersion="0.2.4-dev",L.drawLocal={draw:{toolbar:{actions:{title:"Cancel drawing",text:"Cancel"},undo:{title:"Delete last point drawn",text:"Delete last point"},buttons:{polyline:"Draw a polyline",polygon:"Draw a polygon",rectangle:"Draw a rectangle",circle:"Draw a circle",marker:"Draw a marker",wall:"Draw a wall",window:"Draw a window",door:"Draw a door"}},handlers:{circle:{tooltip:{start:"Click and drag to draw circle."},radius:"Radius"},marker:{tooltip:{start:"Click map to place marker."}},polygon:{tooltip:{start:"Click to start drawing shape.",cont:"Click to continue drawing shape.",end:"Click first point to close this shape."}},polyline:{error:"<strong>Error:</strong> shape edges cannot cross!",tooltip:{start:"Click to start drawing line.",cont:"Click to continue drawing line.",end:"Click last point to finish line."}},rectangle:{tooltip:{start:"Click and drag to draw rectangle."}},simpleshape:{tooltip:{end:"Release mouse to finish drawing."}},wall:{error:"<strong>Error:</strong> shape edges cannot cross!",tooltip:{start:"Click to start drawing wall.",cont:"Click to continue drawing wall.",end:"Click last point to finish wall."}},window:{error:"<strong>Error:</strong> shape edges cannot cross!",tooltip:{start:"Click to start drawing window.",cont:"Click to continue drawing window.",end:"Click last point to finish window."}},door:{error:"<strong>Error:</strong> shape edges cannot cross!",tooltip:{start:"Click to start drawing door.",cont:"Click to continue drawing door.",end:"Click last point to finish door."}}}},edit:{toolbar:{actions:{save:{title:"Apply changes.",text:"Apply"},cancel:{title:"Cancel editing, discards all changes.",text:"Cancel"}},buttons:{edit:"Edit layers.",editDisabled:"No layers to edit.",remove:"Delete layers.",removeDisabled:"No layers to delete."}},handlers:{edit:{tooltip:{text:"Drag handles, or marker to edit feature.",subtext:"Click cancel to undo changes."}},remove:{tooltip:{text:"Click on a feature to remove"}}}}},L.Draw={},L.Draw.Feature=L.Handler.extend({includes:L.Mixin.Events,initialize:function(t,e){this._map=t,this._container=t._container,this._overlayPane=t._panes.overlayPane,this._popupPane=t._panes.popupPane,e&&e.shapeOptions&&(e.shapeOptions=L.Util.extend({},this.options.shapeOptions,e.shapeOptions)),L.setOptions(this,e)},enable:function(){this._enabled||(L.Handler.prototype.enable.call(this),this.fire("enabled",{handler:this.type}),this._map.fire("draw:drawstart",{layerType:this.type,layer:this}))},disable:function(){this._enabled&&(L.Handler.prototype.disable.call(this),this._map.fire("draw:drawstop",{layerType:this.type,layer:this}),this.fire("disabled",{handler:this.type}))},addHooks:function(){var t=this._map;t&&(L.DomUtil.disableTextSelection(),t.getContainer().focus(),this._tooltip=new L.Tooltip(this._map),L.DomEvent.on(this._container,"keyup",this._cancelDrawing,this))},removeHooks:function(){this._map&&(L.DomUtil.enableTextSelection(),this._tooltip.dispose(),this._tooltip=null,L.DomEvent.off(this._container,"keyup",this._cancelDrawing,this))},setOptions:function(t){L.setOptions(this,t)},_fireCreatedEvent:function(t){this._map.fire("draw:created",{layer:t,layerType:this.type})},_cancelDrawing:function(t){27===t.keyCode&&this.disable()}}),L.Draw.Polyline=L.Draw.Feature.extend({statics:{TYPE:"polyline"},Poly:L.Polyline,options:{allowIntersection:!0,repeatMode:!1,drawError:{color:"#bbbbb",timeout:2500},icon:new L.DivIcon({iconSize:new L.Point(8,8),className:"leaflet-div-icon leaflet-editing-icon"}),guidelineDistance:20,maxGuideLineLength:4e3,shapeOptions:{stroke:!0,color:"#bbbbbb",weight:4,opacity:.5,fill:!1,clickable:!0},metric:!0,showLength:!0,zIndexOffset:2e3,toolbarIcon:{className:"leaflet-draw-draw-polyline",tooltip:L.drawLocal.draw.toolbar.buttons.polyline}},initialize:function(t,e){this.options.drawError.message=L.drawLocal.draw.handlers.polyline.error,e&&e.drawError&&(e.drawError=L.Util.extend({},this.options.drawError,e.drawError)),this.type=L.Draw.Polyline.TYPE,L.Draw.Feature.prototype.initialize.call(this,t,e)},addHooks:function(){L.Draw.Feature.prototype.addHooks.call(this),this._map&&(this._markers=[],this._markerGroup=new L.LayerGroup,this._map.addLayer(this._markerGroup),this._poly=new L.Polyline([],this.options.shapeOptions),this._tooltip.updateContent(this._getTooltipText()),this._mouseMarker||(this._mouseMarker=L.marker(this._map.getCenter(),{icon:L.divIcon({className:"leaflet-mouse-marker",iconAnchor:[20,20],iconSize:[40,40]}),opacity:0,zIndexOffset:this.options.zIndexOffset})),this._mouseMarker.on("mousedown",this._onMouseDown,this).addTo(this._map),this._map.on("mousemove",this._onMouseMove,this).on("mouseup",this._onMouseUp,this).on("zoomend",this._onZoomEnd,this))},removeHooks:function(){L.Draw.Feature.prototype.removeHooks.call(this),this._clearHideErrorTimeout(),this._cleanUpShape(),this._map.removeLayer(this._markerGroup),delete this._markerGroup,delete this._markers,this._map.removeLayer(this._poly),delete this._poly,this._mouseMarker.off("mousedown",this._onMouseDown,this),this._map.removeLayer(this._mouseMarker),delete this._mouseMarker,this._clearGuides(),this._map.off("mousemove",this._onMouseMove,this).off("zoomend",this._onZoomEnd,this),this._map.off("mouseup",this._onMouseUp,this)},deleteLastVertex:function(){if(!(this._markers.length<=1)){var t=this._markers.pop(),e=this._poly,i=this._poly.spliceLatLngs(e.getLatLngs().length-1,1)[0];this._markerGroup.removeLayer(t),e.getLatLngs().length<2&&this._map.removeLayer(e),this._vertexChanged(i,!1)}},addVertex:function(t){var e=this._markers.length;return e>0&&!this.options.allowIntersection&&this._poly.newLatLngIntersects(t)?void this._showErrorTooltip():(this._errorShown&&this._hideErrorTooltip(),this._markers.push(this._createMarker(t)),this._poly.addLatLng(t),2===this._poly.getLatLngs().length&&this._map.addLayer(this._poly),void this._vertexChanged(t,!0))},_finishShape:function(){var t=this._poly.newLatLngIntersects(this._poly.getLatLngs()[0],!0);return!this.options.allowIntersection&&t||!this._shapeIsValid()?void this._showErrorTooltip():(this._fireCreatedEvent(),this.disable(),void(this.options.repeatMode&&this.enable()))},_shapeIsValid:function(){return!0},_onZoomEnd:function(){this._updateGuide()},_onMouseMove:function(t){var e=t.layerPoint,i=t.latlng;this._currentLatLng=i,this._updateTooltip(i),this._updateGuide(e),this._mouseMarker.setLatLng(i),L.DomEvent.preventDefault(t.originalEvent)},_vertexChanged:function(t,e){this._updateStartHandler(),this._updateFinishHandler(),this._updateRunningMeasure(t,e),this._clearGuides(),this._updateTooltip()},_onMouseDown:function(t){var e=t.originalEvent;this._mouseDownOrigin=L.point(e.clientX,e.clientY),this._latlngOrigin=t.latlng},_onMouseUp:function(e){if(this._mouseDownOrigin){this._latlngOrigin&&(e.latlng=this._latlngOrigin);var i=L.point(e.originalEvent.clientX,e.originalEvent.clientY).distanceTo(this._mouseDownOrigin);Math.abs(i)<9*(t.devicePixelRatio||1)&&this.addVertex(e.latlng)}this._mouseDownOrigin=null,this._latlngOrigin=null},_updateStartHandler:function(){},_updateFinishHandler:function(){var t=0;this._markers!==i&&(t=this._markers.length),t>1&&this._markers[t-1].on("click",this._finishShape,this),t>2&&this._markers[t-2].off("click",this._finishShape,this)},_createMarker:function(t){var e=new L.Marker(t,{icon:this.options.icon,zIndexOffset:2*this.options.zIndexOffset});return this._markerGroup.addLayer(e),this._map.fire("draw:createmarker",{marker:e,layer:this}),e},_updateGuide:function(t){var e=0;this._markers!==i&&(e=this._markers.length),e>0&&(t=t||this._map.latLngToLayerPoint(this._currentLatLng),this._clearGuides(),this._drawGuide(this._map.latLngToLayerPoint(this._markers[e-1].getLatLng()),t))},_updateTooltip:function(t){if(this._tooltip){var e=this._getTooltipText();t&&this._tooltip.updatePosition(t),this._errorShown||this._tooltip.updateContent(e)}},_drawGuide:function(t,e){var i,n,o,s=Math.floor(Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))),a=this.options.guidelineDistance,r=this.options.maxGuideLineLength,l=s>r?s-r:a;for(this._guidesContainer||(this._guidesContainer=L.DomUtil.create("div","leaflet-draw-guides",this._overlayPane));s>l;l+=this.options.guidelineDistance)i=l/s,n={x:Math.floor(t.x*(1-i)+i*e.x),y:Math.floor(t.y*(1-i)+i*e.y)},o=L.DomUtil.create("div","leaflet-draw-guide-dash",this._guidesContainer),o.style.backgroundColor=this._errorShown?this.options.drawError.color:this.options.shapeOptions.color,L.DomUtil.setPosition(o,n)},_updateGuideColor:function(t){if(this._guidesContainer)for(var e=0,i=this._guidesContainer.childNodes.length;i>e;e++)this._guidesContainer.childNodes[e].style.backgroundColor=t},_clearGuides:function(){if(this._guidesContainer)for(;this._guidesContainer.firstChild;)this._guidesContainer.removeChild(this._guidesContainer.firstChild)},_getTooltipText:function(){var t,e,n=this.options.showLength,o=0;return this._markers!==i&&(o=this._markers.length),0===o?t={text:L.drawLocal.draw.handlers.polyline.tooltip.start}:(e=n?this._getMeasurementString():"",t=1===this._markers.length?{text:L.drawLocal.draw.handlers.polyline.tooltip.cont,subtext:e}:{text:L.drawLocal.draw.handlers.polyline.tooltip.end,subtext:e}),t},_updateRunningMeasure:function(t,e){var n,o,s=0;this._markers!==i&&(s=this._markers.length),1>=s?this._measurementRunningTotal=0:(n=s-(e?2:1),o=t.distanceTo(this._markers[n].getLatLng()),this._measurementRunningTotal+=o*(e?1:-1))},_getMeasurementString:function(){var t,e=this._currentLatLng,i=this._markers[this._markers.length-1].getLatLng();return t=this._measurementRunningTotal+e.distanceTo(i),L.GeometryUtil.readableDistance(t,this.options.metric)},_showErrorTooltip:function(){this._errorShown=!0,this._tooltip.showAsError().updateContent({text:this.options.drawError.message}),this._updateGuideColor(this.options.drawError.color),this._poly.setStyle({color:this.options.drawError.color}),this._clearHideErrorTimeout(),this._hideErrorTimeout=setTimeout(L.Util.bind(this._hideErrorTooltip,this),this.options.drawError.timeout)},_hideErrorTooltip:function(){this._errorShown=!1,this._clearHideErrorTimeout(),this._tooltip.removeError().updateContent(this._getTooltipText()),this._updateGuideColor(this.options.shapeOptions.color),this._poly.setStyle({color:this.options.shapeOptions.color})},_clearHideErrorTimeout:function(){this._hideErrorTimeout&&(clearTimeout(this._hideErrorTimeout),this._hideErrorTimeout=null)},_cleanUpShape:function(){this._markers.length>1&&this._markers[this._markers.length-1].off("click",this._finishShape,this)},_fireCreatedEvent:function(){var t=new this.Poly(this._poly.getLatLngs(),this.options.shapeOptions);L.Draw.Feature.prototype._fireCreatedEvent.call(this,t)}}),L.Draw.Polygon=L.Draw.Polyline.extend({statics:{TYPE:"polygon"},Poly:L.Polygon,options:{showArea:!1,shapeOptions:{stroke:!0,color:"#bbbbbb",weight:4,opacity:.5,fill:!1,fillColor:null,fillOpacity:.2,clickable:!0},toolbarIcon:{className:"leaflet-draw-draw-polygon",tooltip:L.drawLocal.draw.toolbar.buttons.polygon}},initialize:function(t,e){L.Draw.Polyline.prototype.initialize.call(this,t,e),this.type=L.Draw.Polygon.TYPE},_updateFinishHandler:function(){var t=this._markers.length;1===t&&this._markers[0].on("click",this._finishShape,this),t>2&&(this._markers[t-1].on("dblclick",this._finishShape,this),t>3&&this._markers[t-2].off("dblclick",this._finishShape,this))},_getTooltipText:function(){var t,e;return 0===this._markers.length?t=L.drawLocal.draw.handlers.polygon.tooltip.start:this._markers.length<3?t=L.drawLocal.draw.handlers.polygon.tooltip.cont:(t=L.drawLocal.draw.handlers.polygon.tooltip.end,e=this._getMeasurementString()),{text:t,subtext:e}},_getMeasurementString:function(){var t=this._area;return t?L.GeometryUtil.readableArea(t,this.options.metric):null},_shapeIsValid:function(){return this._markers.length>=3},_vertexChanged:function(t,e){var i;!this.options.allowIntersection&&this.options.showArea&&(i=this._poly.getLatLngs(),this._area=L.GeometryUtil.geodesicArea(i)),L.Draw.Polyline.prototype._vertexChanged.call(this,t,e)},_cleanUpShape:function(){var t=this._markers.length;t>0&&(this._markers[0].off("click",this._finishShape,this),t>2&&this._markers[t-1].off("dblclick",this._finishShape,this))}}),L.SimpleShape={},L.Draw.SimpleShape=L.Draw.Feature.extend({options:{repeatMode:!1},initialize:function(t,e){this._endLabelText=L.drawLocal.draw.handlers.simpleshape.tooltip.end,L.Draw.Feature.prototype.initialize.call(this,t,e)},addHooks:function(){L.Draw.Feature.prototype.addHooks.call(this),this._map&&(this._mapDraggable=this._map.dragging.enabled(),this._mapDraggable&&this._map.dragging.disable(),this._container.style.cursor="crosshair",this._tooltip.updateContent({text:this._initialLabelText}),this._map.on("mousedown",this._onMouseDown,this).on("mousemove",this._onMouseMove,this))},removeHooks:function(){L.Draw.Feature.prototype.removeHooks.call(this),this._map&&(this._mapDraggable&&this._map.dragging.enable(),this._container.style.cursor="",this._map.off("mousedown",this._onMouseDown,this).off("mousemove",this._onMouseMove,this),L.DomEvent.off(e,"mouseup",this._onMouseUp,this),this._shape&&(this._map.removeLayer(this._shape),delete this._shape)),this._isDrawing=!1},_getTooltipText:function(){return{text:this._endLabelText}},_onMouseDown:function(t){this._isDrawing=!0,this._startLatLng=t.latlng,L.DomEvent.on(e,"mouseup",this._onMouseUp,this).preventDefault(t.originalEvent)},_onMouseMove:function(t){var e=t.latlng;this._tooltip.updatePosition(e),this._isDrawing&&(this._tooltip.updateContent(this._getTooltipText()),this._drawShape(e))},_onMouseUp:function(){this._shape&&this._fireCreatedEvent(),this.disable(),this.options.repeatMode&&this.enable()}}),L.Draw.Rectangle=L.Draw.SimpleShape.extend({statics:{TYPE:"rectangle"},options:{shapeOptions:{stroke:!0,color:"#bbbbbb",weight:4,opacity:.5,fill:!1,fillColor:null,fillOpacity:.5,clickable:!0},metric:!0},initialize:function(t,e){this.type=L.Draw.Rectangle.TYPE,this._initialLabelText=L.drawLocal.draw.handlers.rectangle.tooltip.start,L.Draw.SimpleShape.prototype.initialize.call(this,t,e)},_drawShape:function(t){this._shape?this._shape.setBounds(new L.LatLngBounds(this._startLatLng,t)):(this._shape=new L.Rectangle(new L.LatLngBounds(this._startLatLng,t),this.options.shapeOptions),this._map.addLayer(this._shape))},_fireCreatedEvent:function(){var t=new L.Rectangle(this._shape.getBounds(),this.options.shapeOptions);L.Draw.SimpleShape.prototype._fireCreatedEvent.call(this,t)},_getTooltipText:function(){var t,e,i,n=L.Draw.SimpleShape.prototype._getTooltipText.call(this),o=this._shape;return o&&(t=this._shape.getLatLngs(),e=L.GeometryUtil.geodesicArea(t),i=L.GeometryUtil.readableArea(e,this.options.metric)),{text:n.text,subtext:i}}}),L.Draw.Circle=L.Draw.SimpleShape.extend({statics:{TYPE:"circle"},options:{shapeOptions:{stroke:!0,color:"#bbbbbb",weight:4,opacity:.5,fill:!0,fillColor:null,fillOpacity:.2,clickable:!0},showRadius:!0,metric:!0,toolbarIcon:{className:"leaflet-draw-draw-circle",tooltip:L.drawLocal.draw.toolbar.buttons.circle}},initialize:function(t,e){this.type=L.Draw.Circle.TYPE,this._initialLabelText=L.drawLocal.draw.handlers.circle.tooltip.start,L.Draw.SimpleShape.prototype.initialize.call(this,t,e)},_drawShape:function(t){this._shape?this._shape.setRadius(this._startLatLng.distanceTo(t)):(this._shape=new L.Circle(this._startLatLng,this._startLatLng.distanceTo(t),this.options.shapeOptions),this._map.addLayer(this._shape))},_fireCreatedEvent:function(){var t=new L.Circle(this._startLatLng,this._shape.getRadius(),this.options.shapeOptions);L.Draw.SimpleShape.prototype._fireCreatedEvent.call(this,t)},_onMouseMove:function(t){var e,i=t.latlng,n=this.options.showRadius,o=this.options.metric;this._tooltip.updatePosition(i),this._isDrawing&&(this._drawShape(i),e=this._shape.getRadius().toFixed(1),this._tooltip.updateContent({text:this._endLabelText,subtext:n?L.drawLocal.draw.handlers.circle.radius+": "+L.GeometryUtil.readableDistance(e,o):""}))}}),L.Draw.Marker=L.Draw.Feature.extend({statics:{TYPE:"marker"},options:{icon:new L.Icon.Default,repeatMode:!1,zIndexOffset:2e3,toolbarIcon:{className:"leaflet-draw-draw-marker",tooltip:L.drawLocal.draw.toolbar.buttons.marker}},initialize:function(t,e){this.type=L.Draw.Marker.TYPE,L.Draw.Feature.prototype.initialize.call(this,t,e)},addHooks:function(){L.Draw.Feature.prototype.addHooks.call(this),this._map&&(this._tooltip.updateContent({text:L.drawLocal.draw.handlers.marker.tooltip.start}),this._mouseMarker||(this._mouseMarker=L.marker(this._map.getCenter(),{icon:L.divIcon({className:"leaflet-mouse-marker",iconAnchor:[20,20],iconSize:[40,40]}),opacity:0,zIndexOffset:this.options.zIndexOffset})),this._mouseMarker.on("click",this._onClick,this).addTo(this._map),this._map.on("mousemove",this._onMouseMove,this))},removeHooks:function(){L.Draw.Feature.prototype.removeHooks.call(this),this._map&&(this._marker&&(this._marker.off("click",this._onClick,this),this._map.off("click",this._onClick,this).removeLayer(this._marker),delete this._marker),this._mouseMarker.off("click",this._onClick,this),this._map.removeLayer(this._mouseMarker),delete this._mouseMarker,this._map.off("mousemove",this._onMouseMove,this))},_onMouseMove:function(t){var e=t.latlng;this._tooltip.updatePosition(e),this._mouseMarker.setLatLng(e),this._marker?(e=this._mouseMarker.getLatLng(),this._marker.setLatLng(e)):(this._marker=new L.Marker(e,{icon:this.options.icon,zIndexOffset:this.options.zIndexOffset}),this._marker.on("click",this._onClick,this),this._map.on("click",this._onClick,this).addLayer(this._marker))},_onClick:function(){this._fireCreatedEvent(),this.disable(),this.options.repeatMode&&this.enable()},_fireCreatedEvent:function(){var t=new L.Marker(this._marker.getLatLng(),{icon:this.options.icon});L.Draw.Feature.prototype._fireCreatedEvent.call(this,t)}}),L.Draw.Wall=L.Draw.Polyline.extend({statics:{TYPE:"wall"},Poly:L.Polyline,options:{allowIntersection:!0,repeatMode:!1,drawError:{color:"#bbbbb",timeout:2500},icon:new L.DivIcon({iconSize:new L.Point(8,8),className:"leaflet-div-icon leaflet-editing-icon"}),guidelineDistance:20,maxGuideLineLength:4e3,shapeOptions:{stroke:!0,color:"#bbbbbb",weight:4,opacity:.5,fill:!1,clickable:!0},metric:!0,showLength:!0,zIndexOffset:2e3,toolbarIcon:{className:"leaflet-draw-draw-polyline",tooltip:L.drawLocal.draw.toolbar.buttons.polyline}},initialize:function(t,e){L.Draw.Polyline.prototype.initialize.call(this,t,e),this.type="wall"},_updateStartHandler:function(){var t=0;this._markers!==i&&(t=this._markers.length),3===t&&this._markers[0].on("click",this._closeShape,this)},_closeShape:function(){this.Poly=L.Polygon,this._finishShape(),this.Poly=L.Polyline}}),L.Draw.Window=L.Draw.Polyline.extend({statics:{TYPE:"window"},Poly:L.Polyline,options:{allowIntersection:!0,repeatMode:!1,drawError:{color:"#bbbbb",timeout:2500},icon:new L.DivIcon({iconSize:new L.Point(8,8),className:"leaflet-div-icon leaflet-editing-icon"}),guidelineDistance:20,maxGuideLineLength:4e3,shapeOptions:{stroke:!0,color:"#bbbbbb",weight:4,opacity:.5,fill:!1,clickable:!0},metric:!0,showLength:!0,zIndexOffset:2e3,toolbarIcon:{className:"leaflet-draw-draw-polyline",tooltip:L.drawLocal.draw.toolbar.buttons.polyline}},initialize:function(t,e){L.Draw.Polyline.prototype.initialize.call(this,t,e),this.type="window"},_updateFinishHandler:function(){var t=this._markers.length;t>1&&(this._markers[t-1].on("click",this._finishShape,this),this._finishShape())}}),L.Draw.Door=L.Draw.Polyline.extend({statics:{TYPE:"door"},Poly:L.Polyline,options:{allowIntersection:!0,repeatMode:!1,drawError:{color:"#bbbbb",timeout:2500},icon:new L.DivIcon({iconSize:new L.Point(8,8),className:"leaflet-div-icon leaflet-editing-icon"}),guidelineDistance:20,maxGuideLineLength:4e3,shapeOptions:{stroke:!0,color:"#bbbbbb",weight:4,opacity:.5,fill:!1,clickable:!0},metric:!0,showLength:!0,zIndexOffset:2e3,toolbarIcon:{className:"leaflet-draw-draw-polyline",tooltip:L.drawLocal.draw.toolbar.buttons.polyline}},initialize:function(t,e){L.Draw.Polyline.prototype.initialize.call(this,t,e),this.type="door"},_updateFinishHandler:function(){var t=this._markers.length;t>1&&(this._markers[t-1].on("click",this._finishShape,this),this._finishShape())}}),L.Edit=L.Edit||{},L.Edit.Marker=L.Handler.extend({initialize:function(t,e){this._marker=t,L.setOptions(this,e)},addHooks:function(){var t=this._marker;t.dragging.enable(),t.on("dragend",this._onDragEnd,t),this._toggleMarkerHighlight()},removeHooks:function(){var t=this._marker;t.dragging.disable(),t.off("dragend",this._onDragEnd,t),this._toggleMarkerHighlight()},_onDragEnd:function(t){var e=t.target;e.edited=!0},_toggleMarkerHighlight:function(){if(this._icon){var t=this._icon;t.style.display="none",L.DomUtil.hasClass(t,"leaflet-edit-marker-selected")?(L.DomUtil.removeClass(t,"leaflet-edit-marker-selected"),this._offsetMarker(t,-4)):(L.DomUtil.addClass(t,"leaflet-edit-marker-selected"),this._offsetMarker(t,4)),t.style.display=""}},_offsetMarker:function(t,e){var i=parseInt(t.style.marginTop,10)-e,n=parseInt(t.style.marginLeft,10)-e;t.style.marginTop=i+"px",t.style.marginLeft=n+"px"}}),L.Marker.addInitHook(function(){L.Edit.Marker&&(this.editing=new L.Edit.Marker(this),this.options.editable&&this.editing.enable())}),L.Edit=L.Edit||{},L.Edit.Poly=L.Handler.extend({options:{icon:new L.DivIcon({iconSize:new L.Point(8,8),className:"leaflet-div-icon leaflet-editing-icon"})},initialize:function(t,e){this._poly=t,L.setOptions(this,e)},addHooks:function(){var t=this._poly;t.setStyle(t.options.editing),this._poly._map&&(this._markerGroup||this._initMarkers(),this._poly._map.addLayer(this._markerGroup))},removeHooks:function(){var t=this._poly;t.setStyle(t.options.original),t._map&&(t._map.removeLayer(this._markerGroup),delete this._markerGroup,delete this._markers)},updateMarkers:function(){this._markerGroup.clearLayers(),this._initMarkers()},_initMarkers:function(){this._markerGroup||(this._markerGroup=new L.LayerGroup),this._markers=[];var t,e,i,n,o=this._poly._latlngs;for(t=0,i=o.length;i>t;t++)n=this._createMarker(o[t],t),n.on("click",this._onMarkerClick,this),this._markers.push(n);var s,a;for(t=0,e=i-1;i>t;e=t++)(0!==t||L.Polygon&&this._poly instanceof L.Polygon)&&(s=this._markers[e],a=this._markers[t],this._createMiddleMarker(s,a),this._updatePrevNext(s,a))},_createMarker:function(t,e){var i=new L.Marker(t,{draggable:!0,icon:this.options.icon});return i._origLatLng=t,i._index=e,i.on("drag",this._onMarkerDrag,this),i.on("dragend",this._fireEdit,this),this._markerGroup.addLayer(i),i},_removeMarker:function(t){var e=t._index;this._markerGroup.removeLayer(t),this._markers.splice(e,1),this._poly.spliceLatLngs(e,1),this._updateIndexes(e,-1),t.off("drag",this._onMarkerDrag,this).off("dragend",this._fireEdit,this).off("click",this._onMarkerClick,this)},_fireEdit:function(){this._poly.edited=!0,this._poly.fire("edit"),this._poly._map.fire("edit",{layer:this._poly})},_onMarkerDrag:function(t){var e=t.target;L.extend(e._origLatLng,e._latlng),e._middleLeft&&e._middleLeft.setLatLng(this._getMiddleLatLng(e._prev,e)),e._middleRight&&e._middleRight.setLatLng(this._getMiddleLatLng(e,e._next)),this._poly.redraw()},_onMarkerClick:function(t){var e=L.Polygon&&this._poly instanceof L.Polygon?4:3,i=t.target;this._poly._latlngs.length<e||(this._removeMarker(i),this._updatePrevNext(i._prev,i._next),i._middleLeft&&this._markerGroup.removeLayer(i._middleLeft),i._middleRight&&this._markerGroup.removeLayer(i._middleRight),i._prev&&i._next?this._createMiddleMarker(i._prev,i._next):i._prev?i._next||(i._prev._middleRight=null):i._next._middleLeft=null,this._fireEdit())},_updateIndexes:function(t,e){this._markerGroup.eachLayer(function(i){i._index>t&&(i._index+=e)})},_createMiddleMarker:function(t,e){var i,n,o,s=this._getMiddleLatLng(t,e),a=this._createMarker(s);a.setOpacity(.6),t._middleRight=e._middleLeft=a,n=function(){var n=e._index;a._index=n,a.off("click",i,this).on("click",this._onMarkerClick,this),s.lat=a.getLatLng().lat,s.lng=a.getLatLng().lng,this._poly.spliceLatLngs(n,0,s),this._markers.splice(n,0,a),a.setOpacity(1),this._updateIndexes(n,1),e._index++,this._updatePrevNext(t,a),this._updatePrevNext(a,e),this._poly.fire("editstart")},o=function(){a.off("dragstart",n,this),a.off("dragend",o,this),this._createMiddleMarker(t,a),this._createMiddleMarker(a,e)},i=function(){n.call(this),o.call(this),this._fireEdit()},a.on("click",i,this).on("dragstart",n,this).on("dragend",o,this),this._markerGroup.addLayer(a)},_updatePrevNext:function(t,e){t&&(t._next=e),e&&(e._prev=t)},_getMiddleLatLng:function(t,e){var i=this._poly._map,n=i.project(t.getLatLng()),o=i.project(e.getLatLng());return i.unproject(n._add(o)._divideBy(2))}}),L.Polyline.addInitHook(function(){this.editing||(L.Edit.Poly&&(this.editing=new L.Edit.Poly(this),this.options.editable&&this.editing.enable()),this.on("add",function(){this.editing&&this.editing.enabled()&&this.editing.addHooks()}),this.on("remove",function(){this.editing&&this.editing.enabled()&&this.editing.removeHooks()}))}),L.Edit=L.Edit||{},L.Edit.SimpleShape=L.Handler.extend({options:{moveIcon:new L.DivIcon({iconSize:new L.Point(8,8),className:"leaflet-div-icon leaflet-editing-icon leaflet-edit-move"}),resizeIcon:new L.DivIcon({iconSize:new L.Point(8,8),className:"leaflet-div-icon leaflet-editing-icon leaflet-edit-resize"})},initialize:function(t,e){this._shape=t,L.Util.setOptions(this,e)},addHooks:function(){var t=this._shape;t.setStyle(t.options.editing),t._map&&(this._map=t._map,this._markerGroup||this._initMarkers(),this._map.addLayer(this._markerGroup))},removeHooks:function(){var t=this._shape;if(t.setStyle(t.options.original),t._map){this._unbindMarker(this._moveMarker);for(var e=0,i=this._resizeMarkers.length;i>e;e++)this._unbindMarker(this._resizeMarkers[e]);
this._resizeMarkers=null,this._map.removeLayer(this._markerGroup),delete this._markerGroup}this._map=null},updateMarkers:function(){this._markerGroup.clearLayers(),this._initMarkers()},_initMarkers:function(){this._markerGroup||(this._markerGroup=new L.LayerGroup),this._createMoveMarker(),this._createResizeMarker()},_createMoveMarker:function(){},_createResizeMarker:function(){},_createMarker:function(t,e){var i=new L.Marker(t,{draggable:!0,icon:e,zIndexOffset:10});return this._bindMarker(i),this._markerGroup.addLayer(i),i},_bindMarker:function(t){t.on("dragstart",this._onMarkerDragStart,this).on("drag",this._onMarkerDrag,this).on("dragend",this._onMarkerDragEnd,this)},_unbindMarker:function(t){t.off("dragstart",this._onMarkerDragStart,this).off("drag",this._onMarkerDrag,this).off("dragend",this._onMarkerDragEnd,this)},_onMarkerDragStart:function(t){var e=t.target;e.setOpacity(0),this._shape.fire("editstart")},_fireEdit:function(){this._shape.edited=!0,this._shape.fire("edit"),this._shape._map.fire("edit",{layer:this._shape})},_onMarkerDrag:function(t){var e=t.target,i=e.getLatLng();e===this._moveMarker?this._move(i):this._resize(i),this._shape.redraw()},_onMarkerDragEnd:function(t){var e=t.target;e.setOpacity(1),this._fireEdit()},_move:function(){},_resize:function(){}}),L.Edit=L.Edit||{},L.Edit.Rectangle=L.Edit.SimpleShape.extend({_createMoveMarker:function(){var t=this._shape.getBounds(),e=t.getCenter();this._moveMarker=this._createMarker(e,this.options.moveIcon)},_createResizeMarker:function(){var t=this._getCorners();this._resizeMarkers=[];for(var e=0,i=t.length;i>e;e++)this._resizeMarkers.push(this._createMarker(t[e],this.options.resizeIcon)),this._resizeMarkers[e]._cornerIndex=e},_onMarkerDragStart:function(t){L.Edit.SimpleShape.prototype._onMarkerDragStart.call(this,t);var e=this._getCorners(),i=t.target,n=i._cornerIndex;this._oppositeCorner=e[(n+2)%4],this._toggleCornerMarkers(0,n)},_onMarkerDragEnd:function(t){var e,i,n=t.target;n===this._moveMarker&&(e=this._shape.getBounds(),i=e.getCenter(),n.setLatLng(i)),this._toggleCornerMarkers(1),this._repositionCornerMarkers(),L.Edit.SimpleShape.prototype._onMarkerDragEnd.call(this,t)},_move:function(t){for(var e,i=this._shape.getLatLngs(),n=this._shape.getBounds(),o=n.getCenter(),s=[],a=0,r=i.length;r>a;a++)e=[i[a].lat-o.lat,i[a].lng-o.lng],s.push([t.lat+e[0],t.lng+e[1]]);this._shape.setLatLngs(s),this._repositionCornerMarkers()},_resize:function(t){var e;this._shape.setBounds(L.latLngBounds(t,this._oppositeCorner)),e=this._shape.getBounds(),this._moveMarker.setLatLng(e.getCenter())},_getCorners:function(){var t=this._shape.getBounds(),e=t.getNorthWest(),i=t.getNorthEast(),n=t.getSouthEast(),o=t.getSouthWest();return[e,i,n,o]},_toggleCornerMarkers:function(t){for(var e=0,i=this._resizeMarkers.length;i>e;e++)this._resizeMarkers[e].setOpacity(t)},_repositionCornerMarkers:function(){for(var t=this._getCorners(),e=0,i=this._resizeMarkers.length;i>e;e++)this._resizeMarkers[e].setLatLng(t[e])}}),L.Rectangle.addInitHook(function(){L.Edit.Rectangle&&(this.editing=new L.Edit.Rectangle(this),this.options.editable&&this.editing.enable())}),L.Edit=L.Edit||{},L.Edit.Circle=L.Edit.SimpleShape.extend({_createMoveMarker:function(){var t=this._shape.getLatLng();this._moveMarker=this._createMarker(t,this.options.moveIcon)},_createResizeMarker:function(){var t=this._shape.getLatLng(),e=this._getResizeMarkerPoint(t);this._resizeMarkers=[],this._resizeMarkers.push(this._createMarker(e,this.options.resizeIcon))},_getResizeMarkerPoint:function(t){var e=this._shape._radius*Math.cos(Math.PI/4),i=this._map.project(t);return this._map.unproject([i.x+e,i.y-e])},_move:function(t){var e=this._getResizeMarkerPoint(t);this._resizeMarkers[0].setLatLng(e),this._shape.setLatLng(t)},_resize:function(t){var e=this._moveMarker.getLatLng(),i=e.distanceTo(t);this._shape.setRadius(i)}}),L.Circle.addInitHook(function(){L.Edit.Circle&&(this.editing=new L.Edit.Circle(this),this.options.editable&&this.editing.enable()),this.on("add",function(){this.editing&&this.editing.enabled()&&this.editing.addHooks()}),this.on("remove",function(){this.editing&&this.editing.enabled()&&this.editing.removeHooks()})}),L.LatLngUtil={cloneLatLngs:function(t){for(var e=[],i=0,n=t.length;n>i;i++)e.push(this.cloneLatLng(t[i]));return e},cloneLatLng:function(t){return L.latLng(t.lat,t.lng)}},L.GeometryUtil=L.extend(L.GeometryUtil||{},{geodesicArea:function(t){var e,i,n=t.length,o=0,s=L.LatLng.DEG_TO_RAD;if(n>2){for(var a=0;n>a;a++)e=t[a],i=t[(a+1)%n],o+=(i.lng-e.lng)*s*(2+Math.sin(e.lat*s)+Math.sin(i.lat*s));o=6378137*o*6378137/2}return Math.abs(o)},readableArea:function(t,e){var i;return e?i=t>=1e4?(1e-4*t).toFixed(2)+" ha":t.toFixed(2)+" m&sup2;":(t/=.836127,i=t>=3097600?(t/3097600).toFixed(2)+" mi&sup2;":t>=4840?(t/4840).toFixed(2)+" acres":Math.ceil(t)+" yd&sup2;"),i},distance:function(t,e,i){return t.latLngToLayerPoint(e).distanceTo(t.latLngToLayerPoint(i))},distanceSegment:function(t,e,i,n){var o=t.latLngToLayerPoint(e),s=t.latLngToLayerPoint(i),a=t.latLngToLayerPoint(n);return L.LineUtil.pointToSegmentDistance(o,s,a)},readableDistance:function(t,e){var i,n="imperial"!==e;return n?i=t>1e3?(t/1e3).toFixed(2)+" km":Math.round(100*t)/100+" m":(t*=1.09361,i=t>1760?(t/1760).toFixed(2)+" miles":Math.round(100*t)/100+" yd"),i},belongsSegment:function(t,e,n,o){o=o===i?.2:o;var s=e.distanceTo(n),a=e.distanceTo(t)+t.distanceTo(n)-s;return o>a/s},length:function(t){var e=L.GeometryUtil.accumulatedLengths(t);return e.length>0?e[e.length-1]:0},accumulatedLengths:function(t){if("function"==typeof t.getLatLngs&&(t=t.getLatLngs()),0===t.length)return[];for(var e=0,i=[0],n=0,o=t.length-1;o>n;n++)e+=t[n].distanceTo(t[n+1]),i.push(e);return i},closestOnSegment:function(t,e,i,n){var o=t.getMaxZoom();o===1/0&&(o=t.getZoom());var s=t.project(e,o),a=t.project(i,o),r=t.project(n,o),l=L.LineUtil.closestPointOnSegment(s,a,r);return t.unproject(l,o)},closest:function(t,e,i,n){"function"!=typeof e.getLatLngs&&(e=L.polyline(e));var o,s,a,r=e.getLatLngs().slice(0),l=1/0,h=null,d=1/0;if(n){for(o=0,s=r.length;s>o;o++)a=r[o],d=L.GeometryUtil.distance(t,i,a),l>d&&(l=d,h=a,d=d);return h?{latlng:h,distance:d}:null}for(e instanceof L.Polygon&&r.push(r[0]),o=0,s=r.length;s-1>o;o++){var p=r[o],c=r[o+1];d=L.GeometryUtil.distanceSegment(t,i,p,c),l>=d&&(l=d,h=L.GeometryUtil.closestOnSegment(t,i,p,c))}return h?{latlng:h,distance:l}:null},closestLayer:function(t,e,i){for(var n=1/0,o=null,s=null,a=1/0,r=0,l=e.length;l>r;r++){var h=e[r];"function"==typeof h.getLatLng?(s=h.getLatLng(),a=L.GeometryUtil.distance(t,i,s)):(s=L.GeometryUtil.closest(t,h,i),s&&(a=s.distance)),n>a&&(n=a,o={layer:h,latlng:s.latlng,distance:a})}return o},closestLayerSnap:function(t,e,i,n,o){n="number"==typeof n?n:1/0,o="boolean"==typeof o?o:!0;var s=L.GeometryUtil.closestLayer(t,e,i);if(!s||s.distance>n)return null;if(o&&"function"==typeof s.layer.getLatLngs){var a=L.GeometryUtil.closest(t,s.layer,s.latlng,!0);a.distance<n&&(s.latlng=a.latlng,s.distance=L.GeometryUtil.distance(t,a.latlng,i))}return s},interpolateOnPointSegment:function(t,e,i){return L.point(t.x*(1-i)+i*e.x,t.y*(1-i)+i*e.y)},interpolateOnLine:function(t,e,i){e=e instanceof L.Polyline?e.getLatLngs():e;var n=e.length;if(2>n)return null;if(0===i)return{latLng:e[0]instanceof L.LatLng?e[0]:L.latLng(e[0]),predecessor:-1};if(1===i)return{latLng:e[e.length-1]instanceof L.LatLng?e[e.length-1]:L.latLng(e[e.length-1]),predecessor:e.length-2};i=Math.max(Math.min(i,1),0);var o=t.getMaxZoom();o===1/0&&(o=t.getZoom());for(var s=[],a=0,r=0;n>r;r++)s[r]=t.project(e[r],o),r>0&&(a+=s[r-1].distanceTo(s[r]));for(var l=a*i,h=s[0],d=s[1],p=0,c=h.distanceTo(d),u=1;n>u&&l>c;u++)h=d,p=c,d=s[u],c+=h.distanceTo(d);var g=c-p!==0?(l-p)/(c-p):0,_=L.GeometryUtil.interpolateOnPointSegment(h,d,g);return{latLng:t.unproject(_,o),predecessor:u-2}},locateOnLine:function(t,e,i){var n=e.getLatLngs();if(i.equals(n[0]))return 0;if(i.equals(n[n.length-1]))return 1;for(var o=L.GeometryUtil.closest(t,e,i,!1),s=L.GeometryUtil.accumulatedLengths(n),a=s[s.length-1],r=0,l=!1,h=0,d=n.length-1;d>h;h++){var p=n[h],c=n[h+1];if(r=s[h],L.GeometryUtil.belongsSegment(o,p,c)){r+=p.distanceTo(o),l=!0;break}}if(!l)throw"Could not interpolate "+i.toString()+" within "+e.toString();return r/a},reverse:function(t){return L.polyline(t.getLatLngs().slice(0).reverse())},extract:function(t,e,i,n){if(i>n)return L.GeometryUtil.extract(t,L.GeometryUtil.reverse(e),1-i,1-n);i=Math.max(Math.min(i,1),0),n=Math.max(Math.min(n,1),0);var o=e.getLatLngs(),s=L.GeometryUtil.interpolateOnLine(t,e,i),a=L.GeometryUtil.interpolateOnLine(t,e,n);if(i===n){var r=L.GeometryUtil.interpolateOnLine(t,e,n);return[r.latLng]}-1===s.predecessor&&(s.predecessor=0),-1===a.predecessor&&(a.predecessor=0);var l=o.slice(s.predecessor+1,a.predecessor+1);return l.unshift(s.latLng),l.push(a.latLng),l},isBefore:function(t,e){if(!e)return!1;var i=t.getLatLngs(),n=e.getLatLngs();return i[i.length-1].equals(n[0])},isAfter:function(t,e){if(!e)return!1;var i=t.getLatLngs(),n=e.getLatLngs();return i[0].equals(n[n.length-1])},startsAtExtremity:function(t,e){if(!e)return!1;var i=t.getLatLngs(),n=e.getLatLngs(),o=i[0];return o.equals(n[0])||o.equals(n[n.length-1])},computeAngle:function(t,e){return 180*Math.atan2(e.y-t.y,e.x-t.x)/Math.PI},computeSlope:function(t,e){var i=(e.y-t.y)/(e.x-t.x),n=t.y-i*t.x;return{a:i,b:n}},rotatePoint:function(t,e,i,n){var o=t.getMaxZoom();o===1/0&&(o=t.getZoom());var s=i*Math.PI/180,a=t.project(e,o),r=t.project(n,o),l=Math.cos(s)*(a.x-r.x)-Math.sin(s)*(a.y-r.y)+r.x,h=Math.sin(s)*(a.x-r.x)+Math.cos(s)*(a.y-r.y)+r.y;return t.unproject(new L.Point(l,h),o)}}),L.Util.extend(L.LineUtil,{segmentsIntersect:function(t,e,i,n){return this._checkCounterclockwise(t,i,n)!==this._checkCounterclockwise(e,i,n)&&this._checkCounterclockwise(t,e,i)!==this._checkCounterclockwise(t,e,n)},_checkCounterclockwise:function(t,e,i){return(i.y-t.y)*(e.x-t.x)>(e.y-t.y)*(i.x-t.x)}}),L.Polyline.include({intersects:function(){var t,e,i,n=this._originalPoints,o=n?n.length:0;if(this._tooFewPointsForIntersection())return!1;for(t=o-1;t>=3;t--)if(e=n[t-1],i=n[t],this._lineSegmentsIntersectsRange(e,i,t-2))return!0;return!1},newLatLngIntersects:function(t,e){return this._map?this.newPointIntersects(this._map.latLngToLayerPoint(t),e):!1},newPointIntersects:function(t,e){var i=this._originalPoints,n=i?i.length:0,o=i?i[n-1]:null,s=n-2;return this._tooFewPointsForIntersection(1)?!1:this._lineSegmentsIntersectsRange(o,t,s,e?1:0)},_tooFewPointsForIntersection:function(t){var e=this._originalPoints,i=e?e.length:0;return i+=t||0,!this._originalPoints||3>=i},_lineSegmentsIntersectsRange:function(t,e,i,n){var o,s,a=this._originalPoints;n=n||0;for(var r=i;r>n;r--)if(o=a[r-1],s=a[r],L.LineUtil.segmentsIntersect(t,e,o,s))return!0;return!1}}),L.Polygon.include({intersects:function(){var t,e,i,n,o,s=this._originalPoints;return this._tooFewPointsForIntersection()?!1:(t=L.Polyline.prototype.intersects.call(this))?!0:(e=s.length,i=s[0],n=s[e-1],o=e-2,this._lineSegmentsIntersectsRange(n,i,o,1))}}),L.GeometryUtil=L.extend(L.GeometryUtil||{},{closestGridSnap:function(t,e,n,o){if(n===i)return null;if(1e-11>n)return null;o="number"==typeof o?o:1/0;var s=Math.cos(e.lat*Math.PI/180),a=6378137*Math.PI,r=180*n/(a*s),l=180*n/a,h=Math.round((e.lat-Math.round(e.lat))/r)*r+Math.round(e.lat),d=Math.round(e.lng/l)*l,p={};return p.latlng=new L.LatLng(h,d),p.distance=t.latLngToLayerPoint(e).distanceTo(t.latLngToLayerPoint(p.latlng)),p.GridStep=n,!p||p.distance>o?null:p}}),L.Control.Draw=L.Control.extend({options:{position:"topleft",draw:{},edit:!1},initialize:function(t){if(L.version<"0.7")throw new Error("Leaflet.draw 0.2.3+ requires Leaflet 0.7.0+. Download latest from https://github.com/Leaflet/Leaflet/");L.Control.prototype.initialize.call(this,t);var e;this._toolbars={},L.DrawToolbar&&this.options.draw&&(e=new L.DrawToolbar(this.options.draw),this._toolbars[L.DrawToolbar.TYPE]=e,this._toolbars[L.DrawToolbar.TYPE].on("enable",this._toolbarEnabled,this)),L.EditToolbar&&this.options.edit&&(e=new L.EditToolbar(this.options.edit),this._toolbars[L.EditToolbar.TYPE]=e,this._toolbars[L.EditToolbar.TYPE].on("enable",this._toolbarEnabled,this))},onAdd:function(t){var e,i=L.DomUtil.create("div","leaflet-draw"),n=!1,o="leaflet-draw-toolbar-top";for(var s in this._toolbars)this._toolbars.hasOwnProperty(s)&&(e=this._toolbars[s].addToolbar(t),e&&(n||(L.DomUtil.hasClass(e,o)||L.DomUtil.addClass(e.childNodes[0],o),n=!0),i.appendChild(e)));return i},onRemove:function(){for(var t in this._toolbars)this._toolbars.hasOwnProperty(t)&&this._toolbars[t].removeToolbar()},setDrawingOptions:function(t){for(var e in this._toolbars)this._toolbars[e]instanceof L.DrawToolbar&&this._toolbars[e].setOptions(t)},_toolbarEnabled:function(t){var e=t.target;for(var i in this._toolbars)this._toolbars[i]!==e&&this._toolbars[i].disable()}}),L.Map.mergeOptions({drawControlTooltips:!0,drawControl:!1}),L.Map.addInitHook(function(){this.options.drawControl&&(this.drawControl=new L.Control.Draw,this.addControl(this.drawControl))}),L.Toolbar=L.Class.extend({includes:[L.Mixin.Events],initialize:function(t){L.setOptions(this,t),this._modes={},this._actionButtons=[],this._activeMode=null},enabled:function(){return null!==this._activeMode},disable:function(){this.enabled()&&this._activeMode.handler.disable()},addToolbar:function(t){var e,i=L.DomUtil.create("div","leaflet-draw-section"),n=0,o=this._toolbarClass||"",s=this.getModeHandlers(t);for(this._toolbarContainer=L.DomUtil.create("div","leaflet-draw-toolbar leaflet-bar"),this._map=t,e=0;e<s.length;e++)s[e].enabled&&this._initModeHandler(s[e].handler,this._toolbarContainer,n++,o,s[e].title);return n?(this._lastButtonIndex=--n,this._actionsContainer=L.DomUtil.create("ul","leaflet-draw-actions"),i.appendChild(this._toolbarContainer),i.appendChild(this._actionsContainer),i):void 0},removeToolbar:function(){for(var t in this._modes)this._modes.hasOwnProperty(t)&&(this._disposeButton(this._modes[t].button,this._modes[t].handler.enable,this._modes[t].handler),this._modes[t].handler.disable(),this._modes[t].handler.off("enabled",this._handlerActivated,this).off("disabled",this._handlerDeactivated,this));this._modes={};for(var e=0,i=this._actionButtons.length;i>e;e++)this._disposeButton(this._actionButtons[e].button,this._actionButtons[e].callback,this);this._actionButtons=[],this._actionsContainer=null},_initModeHandler:function(t,e,i,n,o){var s=t.type;this._modes[s]={},this._modes[s].handler=t,this._modes[s].button=this._createButton({title:o,className:n+"-"+s,container:e,callback:this._modes[s].handler.enable,context:this._modes[s].handler}),this._modes[s].buttonIndex=i,this._modes[s].handler.on("enabled",this._handlerActivated,this).on("disabled",this._handlerDeactivated,this)},_createButton:function(t){var e=L.DomUtil.create("a",t.className||"",t.container);return e.href="#",t.text&&(e.innerHTML=t.text),t.title&&(e.title=t.title),L.DomEvent.on(e,"click",L.DomEvent.stopPropagation).on(e,"mousedown",L.DomEvent.stopPropagation).on(e,"dblclick",L.DomEvent.stopPropagation).on(e,"click",L.DomEvent.preventDefault).on(e,"click",t.callback,t.context),e},_disposeButton:function(t,e){L.DomEvent.off(t,"click",L.DomEvent.stopPropagation).off(t,"mousedown",L.DomEvent.stopPropagation).off(t,"dblclick",L.DomEvent.stopPropagation).off(t,"click",L.DomEvent.preventDefault).off(t,"click",e)},_handlerActivated:function(t){this.disable(),this._activeMode=this._modes[t.handler],L.DomUtil.addClass(this._activeMode.button,"leaflet-draw-toolbar-button-enabled"),this._showActionsToolbar(),this.fire("enable")},_handlerDeactivated:function(){this._hideActionsToolbar(),L.DomUtil.removeClass(this._activeMode.button,"leaflet-draw-toolbar-button-enabled"),this._activeMode=null,this.fire("disable")},_createActions:function(t){var e,i,n,o,s=this._actionsContainer,a=this.getActions(t),r=a.length;for(i=0,n=this._actionButtons.length;n>i;i++)this._disposeButton(this._actionButtons[i].button,this._actionButtons[i].callback);for(this._actionButtons=[];s.firstChild;)s.removeChild(s.firstChild);for(var l=0;r>l;l++)"enabled"in a[l]&&!a[l].enabled||(e=L.DomUtil.create("li","",s),o=this._createButton({title:a[l].title,text:a[l].text,container:e,callback:a[l].callback,context:a[l].context}),this._actionButtons.push({button:o,callback:a[l].callback}))},_showActionsToolbar:function(){var t=this._activeMode.buttonIndex,e=this._lastButtonIndex,i=this._activeMode.button.offsetTop-1;this._createActions(this._activeMode.handler),this._actionsContainer.style.top=i+"px",0===t&&(L.DomUtil.addClass(this._toolbarContainer,"leaflet-draw-toolbar-notop"),L.DomUtil.addClass(this._actionsContainer,"leaflet-draw-actions-top")),t===e&&(L.DomUtil.addClass(this._toolbarContainer,"leaflet-draw-toolbar-nobottom"),L.DomUtil.addClass(this._actionsContainer,"leaflet-draw-actions-bottom")),this._actionsContainer.style.display="block"},_hideActionsToolbar:function(){this._actionsContainer.style.display="none",L.DomUtil.removeClass(this._toolbarContainer,"leaflet-draw-toolbar-notop"),L.DomUtil.removeClass(this._toolbarContainer,"leaflet-draw-toolbar-nobottom"),L.DomUtil.removeClass(this._actionsContainer,"leaflet-draw-actions-top"),L.DomUtil.removeClass(this._actionsContainer,"leaflet-draw-actions-bottom")}}),L.Tooltip=L.Class.extend({initialize:function(t){this._map=t,this._popupPane=t._panes.popupPane,this._container=t.options.drawControlTooltips?L.DomUtil.create("div","leaflet-draw-tooltip",this._popupPane):null,this._singleLineLabel=!1},dispose:function(){this._container&&(this._popupPane.removeChild(this._container),this._container=null)},updateContent:function(t){return this._container?(t.subtext=t.subtext||"",0!==t.subtext.length||this._singleLineLabel?t.subtext.length>0&&this._singleLineLabel&&(L.DomUtil.removeClass(this._container,"leaflet-draw-tooltip-single"),this._singleLineLabel=!1):(L.DomUtil.addClass(this._container,"leaflet-draw-tooltip-single"),this._singleLineLabel=!0),this._container.innerHTML=(t.subtext.length>0?'<span class="leaflet-draw-tooltip-subtext">'+t.subtext+"</span><br />":"")+"<span>"+t.text+"</span>",this):this},updatePosition:function(t){var e=this._map.latLngToLayerPoint(t),i=this._container;return this._container&&(i.style.visibility="inherit",L.DomUtil.setPosition(i,e)),this},showAsError:function(){return this._container&&L.DomUtil.addClass(this._container,"leaflet-error-draw-tooltip"),this},removeError:function(){return this._container&&L.DomUtil.removeClass(this._container,"leaflet-error-draw-tooltip"),this}}),L.DrawToolbar=L.Toolbar.extend({statics:{TYPE:"draw"},options:{wall:{},window:{},door:{}},initialize:function(t){for(var e in this.options)this.options.hasOwnProperty(e)&&t[e]&&(t[e]=L.extend({},this.options[e],t[e]));this._toolbarClass="leaflet-draw-draw",L.Toolbar.prototype.initialize.call(this,t)},getModeHandlers:function(t){return[{enabled:this.options.polyline,handler:new L.Draw.Polyline(t,this.options.polyline),title:L.drawLocal.draw.toolbar.buttons.polyline},{enabled:this.options.polygon,handler:new L.Draw.Polygon(t,this.options.polygon),title:L.drawLocal.draw.toolbar.buttons.polygon},{enabled:this.options.rectangle,handler:new L.Draw.Rectangle(t,this.options.rectangle),title:L.drawLocal.draw.toolbar.buttons.rectangle},{enabled:this.options.circle,handler:new L.Draw.Circle(t,this.options.circle),title:L.drawLocal.draw.toolbar.buttons.circle},{enabled:this.options.marker,handler:new L.Draw.Marker(t,this.options.marker),title:L.drawLocal.draw.toolbar.buttons.marker},{enabled:this.options.wall,handler:new L.Draw.Wall(t,this.options.wall),title:L.drawLocal.draw.toolbar.buttons.wall},{enabled:this.options.window,handler:new L.Draw.Window(t,this.options.window),title:L.drawLocal.draw.toolbar.buttons.window},{enabled:this.options.door,handler:new L.Draw.Door(t,this.options.door),title:L.drawLocal.draw.toolbar.buttons.door}]},getActions:function(){return[{title:L.drawLocal.draw.toolbar.actions.title,text:L.drawLocal.draw.toolbar.actions.text,callback:this.disable,context:this}]},setOptions:function(t){L.setOptions(this,t);for(var e in this._modes)this._modes.hasOwnProperty(e)&&t.hasOwnProperty(e)&&this._modes[e].handler.setOptions(t[e])}}),L.EditToolbar=L.Toolbar.extend({statics:{TYPE:"edit"},options:{edit:{selectedPathOptions:{color:"#fe57a1",opacity:.6,dashArray:"10, 10",fill:!1,fillColor:"#fe57a1",fillOpacity:.1,maintainColor:!1}},remove:{},featureGroup:null},initialize:function(t){t.edit&&("undefined"==typeof t.edit.selectedPathOptions&&(t.edit.selectedPathOptions=this.options.edit.selectedPathOptions),t.edit.selectedPathOptions=L.extend({},this.options.edit.selectedPathOptions,t.edit.selectedPathOptions)),t.remove&&(t.remove=L.extend({},this.options.remove,t.remove)),this._toolbarClass="leaflet-draw-edit",L.Toolbar.prototype.initialize.call(this,t),this._selectedFeatureCount=0},getModeHandlers:function(t){var e=this.options.featureGroup;return[{enabled:this.options.edit,handler:new L.EditToolbar.Edit(t,{featureGroup:e,selectedPathOptions:this.options.edit.selectedPathOptions}),title:L.drawLocal.edit.toolbar.buttons.edit},{enabled:this.options.remove,handler:new L.EditToolbar.Delete(t,{featureGroup:e}),title:L.drawLocal.edit.toolbar.buttons.remove}]},getActions:function(){return[{title:L.drawLocal.edit.toolbar.actions.save.title,text:L.drawLocal.edit.toolbar.actions.save.text,callback:this._save,context:this},{title:L.drawLocal.edit.toolbar.actions.cancel.title,text:L.drawLocal.edit.toolbar.actions.cancel.text,callback:this.disable,context:this}]},addToolbar:function(t){var e=L.Toolbar.prototype.addToolbar.call(this,t);return this._checkDisabled(),this.options.featureGroup.on("layeradd layerremove",this._checkDisabled,this),e},removeToolbar:function(){this.options.featureGroup.off("layeradd layerremove",this._checkDisabled,this),L.Toolbar.prototype.removeToolbar.call(this)},disable:function(){this.enabled()&&(this._activeMode.handler.revertLayers(),L.Toolbar.prototype.disable.call(this))},_save:function(){this._activeMode.handler.save(),this._activeMode.handler.disable()},_checkDisabled:function(){var t,e=this.options.featureGroup,i=0!==e.getLayers().length;this.options.edit&&(t=this._modes[L.EditToolbar.Edit.TYPE].button,i?L.DomUtil.removeClass(t,"leaflet-disabled"):L.DomUtil.addClass(t,"leaflet-disabled"),t.setAttribute("title",i?L.drawLocal.edit.toolbar.buttons.edit:L.drawLocal.edit.toolbar.buttons.editDisabled)),this.options.remove&&(t=this._modes[L.EditToolbar.Delete.TYPE].button,i?L.DomUtil.removeClass(t,"leaflet-disabled"):L.DomUtil.addClass(t,"leaflet-disabled"),t.setAttribute("title",i?L.drawLocal.edit.toolbar.buttons.remove:L.drawLocal.edit.toolbar.buttons.removeDisabled))}}),L.EditToolbar.Edit=L.Handler.extend({statics:{TYPE:"edit"},includes:L.Mixin.Events,initialize:function(t,e){if(L.Handler.prototype.initialize.call(this,t),L.setOptions(this,e),this._featureGroup=e.featureGroup,!(this._featureGroup instanceof L.FeatureGroup))throw new Error("options.featureGroup must be a L.FeatureGroup");this._uneditedLayerProps={},this.type=L.EditToolbar.Edit.TYPE},enable:function(){!this._enabled&&this._hasAvailableLayers()&&(this.fire("enabled",{handler:this.type}),this._map.fire("draw:editstart",{handler:this.type}),L.Handler.prototype.enable.call(this),this._featureGroup.on("layeradd",this._enableLayerEdit,this).on("layerremove",this._disableLayerEdit,this),this._map.fire("draw:editstart_after",{handler:this.type}))},disable:function(){this._enabled&&(this._featureGroup.off("layeradd",this._enableLayerEdit,this).off("layerremove",this._disableLayerEdit,this),L.Handler.prototype.disable.call(this),this._map.fire("draw:editstop",{handler:this.type}),this.fire("disabled",{handler:this.type}))},addHooks:function(){var t=this._map;t&&(t.getContainer().focus(),this._featureGroup.eachLayer(this._enableLayerEdit,this),this._tooltip=new L.Tooltip(this._map),this._tooltip.updateContent({text:L.drawLocal.edit.handlers.edit.tooltip.text,subtext:L.drawLocal.edit.handlers.edit.tooltip.subtext}),this._map.on("mousemove",this._onMouseMove,this))},removeHooks:function(){this._map&&(this._featureGroup.eachLayer(this._disableLayerEdit,this),this._uneditedLayerProps={},this._tooltip.dispose(),this._tooltip=null,this._map.off("mousemove",this._onMouseMove,this))},revertLayers:function(){this._featureGroup.eachLayer(function(t){this._revertLayer(t)},this)},save:function(){var t=new L.LayerGroup;this._featureGroup.eachLayer(function(e){e.edited&&(t.addLayer(e),e.edited=!1)}),this._map.fire("draw:edited",{layers:t})},_backupLayer:function(t){var e=L.Util.stamp(t);this._uneditedLayerProps[e]||(t instanceof L.Polyline||t instanceof L.Polygon||t instanceof L.Rectangle?this._uneditedLayerProps[e]={latlngs:L.LatLngUtil.cloneLatLngs(t.getLatLngs())}:t instanceof L.Circle?this._uneditedLayerProps[e]={latlng:L.LatLngUtil.cloneLatLng(t.getLatLng()),radius:t.getRadius()}:t instanceof L.Marker&&(this._uneditedLayerProps[e]={latlng:L.LatLngUtil.cloneLatLng(t.getLatLng())}))},_revertLayer:function(t){var e=L.Util.stamp(t);t.edited=!1,this._uneditedLayerProps.hasOwnProperty(e)&&(t instanceof L.Polyline||t instanceof L.Polygon||t instanceof L.Rectangle?t.setLatLngs(this._uneditedLayerProps[e].latlngs):t instanceof L.Circle?(t.setLatLng(this._uneditedLayerProps[e].latlng),t.setRadius(this._uneditedLayerProps[e].radius)):t instanceof L.Marker&&t.setLatLng(this._uneditedLayerProps[e].latlng),t.fire("revert-edited",{layer:t}),t._map&&t._map.fire("revert-edited",{layer:t}))},_enableLayerEdit:function(t){var e,i=t.layer||t.target||t;return i.editing?(this._backupLayer(i),this.options.selectedPathOptions&&(e=L.Util.extend({},this.options.selectedPathOptions),e.maintainColor&&(e.color=i.options.color,e.fillColor=i.options.fillColor),i.options.original=L.extend({},i.options),i.options.editing=e),void i.editing.enable()):!1},_disableLayerEdit:function(t){var e=t.layer||t.target||t;return e.editing?(e.edited=!1,e.editing.disable(),delete e.options.editing,void delete e.options.original):!1},_onMouseMove:function(t){this._tooltip.updatePosition(t.latlng)},_hasAvailableLayers:function(){return 0!==this._featureGroup.getLayers().length}}),L.EditToolbar.Delete=L.Handler.extend({statics:{TYPE:"remove"},options:{icon:new L.DivIcon({iconSize:new L.Point(26,26),className:"leaflet-div-icon leaflet-delete-icon"})},includes:L.Mixin.Events,initialize:function(t,e){if(L.Handler.prototype.initialize.call(this,t),L.Util.setOptions(this,e),this._deletableLayers=this.options.featureGroup,!(this._deletableLayers instanceof L.FeatureGroup))throw new Error("options.featureGroup must be a L.FeatureGroup");this.type=L.EditToolbar.Delete.TYPE},enable:function(){!this._enabled&&this._hasAvailableLayers()&&(this.fire("enabled",{handler:this.type}),this._map.fire("draw:deletestart",{handler:this.type}),L.Handler.prototype.enable.call(this),this._deletableLayers.on("layeradd",this._enableLayerDelete,this).on("layerremove",this._disableLayerDelete,this))},disable:function(){this._enabled&&(this._deletableLayers.off("layeradd",this._enableLayerDelete,this).off("layerremove",this._disableLayerDelete,this),L.Handler.prototype.disable.call(this),this._map.fire("draw:deletestop",{handler:this.type}),this.fire("disabled",{handler:this.type}))},addHooks:function(){var t=this._map;t&&(t.getContainer().focus(),this._deletableLayers.eachLayer(this._enableLayerDelete,this),this._deletedLayers=new L.LayerGroup,this._tooltip=new L.Tooltip(this._map),this._tooltip.updateContent({text:L.drawLocal.edit.handlers.remove.tooltip.text}),this._map.on("mousemove",this._onMouseMove,this),this._markerGroup||this._initMarkers(),this._map.addLayer(this._markerGroup))},removeHooks:function(){this._map&&(this._deletableLayers.eachLayer(this._disableLayerDelete,this),this._deletedLayers=null,this._tooltip.dispose(),this._tooltip=null,this._map.off("mousemove",this._onMouseMove,this),this._map.removeLayer(this._markerGroup),delete this._markerGroup,delete this._markers)},revertLayers:function(){this._deletedLayers.eachLayer(function(t){this._deletableLayers.addLayer(t),t.fire("revert-deleted",{layer:t}),this._map.fire("revert-edited",{layer:t})},this)},save:function(){this._map.fire("draw:deleted",{layers:this._deletedLayers})},_enableLayerDelete:function(t){var e=t.layer||t.target||t;e.on("click",this._removeLayer,this)},_disableLayerDelete:function(t){var e=t.layer||t.target||t;e.off("click",this._removeLayer,this),this._deletedLayers.removeLayer(e)},_removeLayer:function(t){var e=t.layer||t.target||t;this._deletableLayers.removeLayer(e),this._deletedLayers.addLayer(e),e.fire("deleted")},_onMouseMove:function(t){this._tooltip.updatePosition(t.latlng)},_hasAvailableLayers:function(){return 0!==this._deletableLayers.getLayers().length},_initMarkers:function(){var t=this;this._markerGroup||(this._markerGroup=new L.LayerGroup),this._markers=[];var e,n,o,s;this._deletableLayers.eachLayer(function(a){if(a.editing._poly!==i){var r=a.editing._poly._latlngs;if(r.length<2)return;e=a.editing._poly._latlngs[0],n=a.editing._poly._latlngs[1],o=new L.LatLng(.33*(2*e.lat+n.lat),.33*(2*e.lng+n.lng));var l=new L.Marker(o,{draggable:!1,icon:t.options.icon});l.setOpacity(.6),l._origLatLng=o,s=function(){t._removeLayer({layer:a}),l.setOpacity(1)},l.on("click",s),t._markerGroup.addLayer(l)}})}}),L.Handler.MarkerSnap=L.Handler.extend({options:{snapType:"undefined",gridStep:.1,snapDistance:6,snapToGrid:!0,snapToObjects:!0,snapVertices:!0},initialize:function(t,e,i){function n(){this._buffer=t.layerPointToLatLng(new L.Point(0,0)).lat-t.layerPointToLatLng(new L.Point(this.options.snapDistance,0)).lat}L.Handler.prototype.initialize.call(this,t),this._markers=[],this._guides=[],2===arguments.length&&(e instanceof L.Class||(i=e,e=null)),L.Util.setOptions(this,i||{}),e&&(e.dragging||(e.dragging=new L.Handler.MarkerDrag(e)),e.dragging.enable(),this.watchMarker(e)),t.on("zoomend",n,this),t.whenReady(n,this),n.call(this)},enable:function(){this.disable();for(var t=0;t<this._markers.length;t++)this.watchMarker(this._markers[t])},disable:function(){for(var t=0;t<this._markers.length;t++)this.unwatchMarker(this._markers[t])},watchMarker:function(t){-1===this._markers.indexOf(t)&&this._markers.push(t),t.on("move",this._snapMarker,this)},unwatchMarker:function(t){t.off("move",this._snapMarker,this),delete t.snap},addGuideLayer:function(t){for(var e=0,i=this._guides.length;i>e&&L.stamp(t)!==L.stamp(this._guides[e]);e++);return this._guides.push(t),this._guides},addGuideLayersFromGroup:function(t){return t.eachLayer(this.addGuideLayer,this),this._guides},removeGuideLayer:function(t){for(var e=0,i=this._guides.length;i>e;e++)if(L.stamp(t)===L.stamp(this._guides[e])){this._guides.splice(e,1);break}return this._guides},_snapMarker:function(t){function e(t){if(t._layers!==i&&"function"!=typeof t.searchBuffer)for(var n in t._layers)e(t._layers[n]);else"function"==typeof t.searchBuffer?s=s.concat(t.searchBuffer(o,this._buffer)):s.push(t)}var n=t.target,o=n.getLatLng(),s=[],a=null;if(this.options.snapToGrid&&(a=this._findClosestGridSnap(this._map,o,this.options.gridStep,this.options.snapDistance),null!==a))return void this._updateSnap(n,n,a.latlng);if(this.options.snapToObjects){for(var r=0,l=this._guides.length;l>r;r++){var h=this._guides[r];h.snapediting!==i&&n._leaflet_id in h.snapediting._markerGroup._layers||e.call(this,h)}a=this._findClosestLayerSnap(this._map,s,o,this.options.snapDistance,this.options.snapVertices)}a=a||{layer:null,latlng:null},this._updateSnap(n,a.layer,a.latlng)},_findClosestLayerSnap:function(t,e,i,n,o){return L.GeometryUtil.closestLayerSnap(t,e,i,n,o)},_findClosestGridSnap:function(t,e,i,n){return L.GeometryUtil.closestGridSnap(t,e,i,n)},_updateSnap:function(t,e,i){e&&i?(t._latlng=L.latLng(i),t.update(),t.snap!==e&&(t.snap=e,t._icon&&L.DomUtil.addClass(t._icon,"marker-snapped"),t.fire("snap",{layer:e,latlng:i}))):(t.snap&&(t._icon&&L.DomUtil.removeClass(t._icon,"marker-snapped"),t.fire("unsnap",{
layer:t.snap})),delete t.snap)}}),L.Handler.PolylineSnap=L.Edit.Poly.extend({initialize:function(t,e,i){var n=this;L.Edit.Poly.prototype.initialize.call(this,e,i),this._snapper=new L.Handler.MarkerSnap(t,i),e.on("remove",function(){n._snapper.disable()})},addGuideLayer:function(t){return this._snapper.addGuideLayer(t),this._snapper._guides},addGuideLayersFromGroup:function(t){return t.eachLayer(this.addGuideLayer,this),this._snapper._guides},removeGuideLayer:function(t){return this._snapper.removeGuideLayer(t),this._snapper._guides},_createMarker:function(t,e){var n=L.Edit.Poly.prototype._createMarker.call(this,t,e),o=e===i;return o?n.on("dragstart",function(){this._snapper.watchMarker(n)},this):this._snapper.watchMarker(n),n}}),L.Draw.Feature.SnapMixin={_snapInitialize:function(){this.on("enabled",this._snapOnEnabled,this),this.on("disabled",this._snapOnDisabled,this)},_snapOnEnabled:function(){if(this.options.guideLayers){if(!this._mouseMarker)return void this._map.on("layeradd",this._snapOnEnabled,this);this._map.off("layeradd",this._snapOnEnabled,this),this._snapper||(this._snapper=new L.Handler.MarkerSnap(this._map),L.Util.setOptions(this._snapper,this.options));for(var t=0,e=this.options.guideLayers.length;e>t;t++)this._snapper.addGuideLayer(this.options.guideLayers[t]);var i=this._mouseMarker;this._snapper.watchMarker(i);var n=i.options.icon;i.on("snap",function(){i.setIcon(this.options.icon),i.setOpacity(1)},this),i.on("unsnap",function(){i.setIcon(n),i.setOpacity(0)},this),i.on("click",this._snapOnClick,this)}},_snapOnClick:function(t){if(this._markers){var e=this._markers.length,i=this._markers[e-1];if(this._mouseMarker.snap){if(t&&(i.setLatLng(t.target._latlng),this._poly)){var n=this._poly._latlngs.length;this._poly._latlngs[n-1]=t.target._latlng,this._poly.redraw()}L.DomUtil.addClass(i._icon,"marker-snapped")}}},_snapOnDisabled:function(){delete this._snapper}},L.Draw.Feature.include(L.Draw.Feature.SnapMixin),L.Draw.Feature.addInitHook("_snapInitialize"),L.Control.GraphicScale=L.Control.extend({options:{position:"bottomleft",updateWhenIdle:!1,minUnitWidth:30,maxUnitsWidth:240,fill:"fill",showSubunits:!0,doubleLine:!1,labelPlacement:"auto"},onAdd:function(t){return this._map=t,this._possibleUnitsNum=[3,5,2,4],this._possibleUnitsNumLen=this._possibleUnitsNum.length,this._possibleDivisions=[1,.5,.25,.2],this._possibleDivisionsLen=this._possibleDivisions.length,this._possibleDivisionsSub={1:{num:2,division:.5},.5:{num:5,division:.1},.25:{num:5,division:.05},.2:{num:2,division:.1}},this._scaleInner=this._buildScale(),this._scale=this._addScale(this._scaleInner),this._setStyle(this.options),t.on(this.options.updateWhenIdle?"moveend":"move",this._update,this),t.whenReady(this._update,this),t.options.graphicScaleControl=this._scale,this._scale},onRemove:function(t){t.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScale:function(t){var e=L.DomUtil.create("div");return e.className="leaflet-control-graphicscale",e.appendChild(t),e},_setStyle:function(t){var e=["leaflet-control-graphicscale-inner"];t.fill&&"nofill"!==t.fill&&(e.push("filled"),e.push("filled-"+t.fill)),t.showSubunits&&e.push("showsubunits"),t.doubleLine&&e.push("double"),e.push("labelPlacement-"+t.labelPlacement),this._scaleInner.className=e.join(" ")},_buildScale:function(){var t=e.createElement("div");t.className="leaflet-control-graphicscale-inner";var i=L.DomUtil.create("div","subunits",t),n=L.DomUtil.create("div","units",t);this._units=[],this._unitsLbls=[],this._subunits=[];for(var o=0;5>o;o++){var s=this._buildDivision(o%2===0);n.appendChild(s),this._units.push(s);var a=this._buildDivisionLbl();s.appendChild(a),this._unitsLbls.push(a);var r=this._buildDivision(o%2===1);i.appendChild(r),this._subunits.unshift(r)}return this._zeroLbl=L.DomUtil.create("div","label zeroLabel"),this._zeroLbl.innerHTML="0",this._units[0].appendChild(this._zeroLbl),this._subunitsLbl=L.DomUtil.create("div","label subunitsLabel"),this._subunitsLbl.innerHTML="?",this._subunits[4].appendChild(this._subunitsLbl),t},_buildDivision:function(t){var e=L.DomUtil.create("div","division"),i=L.DomUtil.create("div","line");e.appendChild(i);var n=L.DomUtil.create("div","line2");return e.appendChild(n),t&&i.appendChild(L.DomUtil.create("div","fill")),t||n.appendChild(L.DomUtil.create("div","fill")),e},_buildDivisionLbl:function(){var t=L.DomUtil.create("div","label divisionLabel");return t},_update:function(){var t=this._map.getBounds(),e=t.getCenter().lat,i=6378137*Math.PI*Math.cos(e*Math.PI/180),n=i*(t.getNorthEast().lng-t.getSouthWest().lng)/180,o=this._map.getSize();o.x>0&&this._updateScale(n,this.options)},_updateScale:function(t,e){var i=this._getBestScale(t,e.minUnitWidth,e.maxUnitsWidth);this._render(i)},_getBestScale:function(t,e,i){var n=this._getPossibleUnits(t,e,this._map.getSize().x),o=this._getPossibleScales(n,i);o.sort(function(t,e){return e.score-t.score});var s=o[0];return s.subunits=this._getSubunits(s),s},_getSubunits:function(t){var e=this._possibleDivisionsSub[t.unit.unitDivision],i={};i.subunitDivision=e.division,i.subunitMeters=e.division*(t.unit.unitMeters/t.unit.unitDivision),i.subunitPx=e.division*(t.unit.unitPx/t.unit.unitDivision);var n={subunit:i,numSubunits:e.num,total:e.num*i.subunitMeters};return n},_getPossibleScales:function(t,e){for(var i,n=[],o=Number.POSITIVE_INFINITY,s=0;s<this._possibleUnitsNumLen;s++)for(var a=this._possibleUnitsNum[s],r=.5*(this._possibleUnitsNumLen-s),l=0;l<t.length;l++){var h=t[l],d=h.unitPx*a,p={unit:h,totalWidthPx:d,numUnits:a,score:0},c=1-(e-d)/e;c*=3;var u=h.unitScore+r+c;(.25===h.unitDivision&&3===a||.5===h.unitDivision&&3===a||.25===h.unitDivision&&5===a)&&(u-=2),p.score=u,e>d&&n.push(p),o>d&&(o=d,i=p)}return n.length||n.push(i),n},_getPossibleUnits:function(t,e,i){for(var n,o=(Math.floor(t)+"").length,s=[],a=o;a>-2;a--){n=Math.pow(10,a);for(var r=0;r<this._possibleDivisionsLen;r++){var l=n*this._possibleDivisions[r],h=i*(l/t);if(e>h)return s;s.push({unitMeters:l,unitPx:h,unitDivision:this._possibleDivisions[r],unitScore:this._possibleDivisionsLen-r})}}return s},_render:function(t){this._renderPart(t.unit.unitPx,t.unit.unitMeters,t.numUnits,this._units,this._unitsLbls),this._renderPart(t.subunits.subunit.subunitPx,t.subunits.subunit.subunitMeters,t.subunits.numSubunits,this._subunits);var e=this._getDisplayUnit(t.subunits.total);this._subunitsLbl.innerHTML=""+e.amount+e.unit},_renderPart:function(t,e,i,n,o){for(var s=this._getDisplayUnit(e),a=0;a<this._units.length;a++){var r=n[a];if(i>a?(r.style.width=t+"px",r.className="division"):(r.style.width=0,r.className="division hidden"),o){var l=o[a],h=["label","divisionLabel"];if(i>a){var d;d=s.amount<1?((a+1)*s.amount).toFixed(2):((a+1)*s.amount).toFixed(0),a===i-1?(d+=s.unit,h.push("labelLast")):h.push("labelSub"),l.innerHTML=d}l.className=h.join(" ")}}},_getDisplayUnit:function(t){1>t&&(t=t.toFixed(2));var e=1e3>t?"m":"km";return{unit:e,amount:"km"===e?t/1e3:t}}}),L.Map.mergeOptions({graphicScaleControl:!1}),L.control.graphicScale=function(t){return new L.Control.GraphicScale(t)},L.Map.addInitHook(function(){this.options.graphicScaleControl&&(this.graphicScaleControl=L.control.graphicScale({doubleLine:!1,fill:"fill",showSubunits:!0}).addTo(this))}),L.SimpleGraticule=L.LayerGroup.extend({options:{interval:20,showOriginLabel:!1,redraw:"move",hidden:!1,zoomIntervals:[{start:0,end:3,interval:5e6},{start:4,end:5,interval:5e5},{start:6,end:7,interval:2e5},{start:8,end:9,interval:1e5},{start:10,end:10,interval:3e4},{start:11,end:11,interval:1e4},{start:12,end:12,interval:6e3},{start:13,end:13,interval:3e3},{start:14,end:14,interval:2e3},{start:15,end:15,interval:1e3},{start:16,end:16,interval:500},{start:17,end:17,interval:250},{start:18,end:19,interval:100},{start:20,end:20,interval:30},{start:21,end:21,interval:10},{start:22,end:22,interval:6},{start:23,end:23,interval:3},{start:24,end:24,interval:2},{start:25,end:25,interval:1},{start:26,end:26,interval:.5},{start:27,end:27,interval:.2},{start:28,end:28,interval:.1},{start:29,end:29,interval:.06},{start:30,end:31,interval:.04},{start:32,end:41,interval:.02}]},lineStyle:{stroke:!0,color:"#111",opacity:.6,weight:1,clickable:!1},initialize:function(t){L.LayerGroup.prototype.initialize.call(this),L.Util.setOptions(this,t)},onAdd:function(t){this._map=t;var e=this.redraw();this._map.on("viewreset "+this.options.redraw,e.redraw,e),this.eachLayer(t.addLayer,t)},onRemove:function(t){t.off("viewreset "+this.options.redraw,this.map),this.eachLayer(this.removeLayer,this),this.options.simpleGraticule=!1},hide:function(){this.options.hidden=!0,this.redraw()},show:function(){this.options.hidden=!1,this.redraw()},redraw:function(){if(this._bounds=this._map.getBounds().pad(0),this.clearLayers(),!this.options.hidden){for(var t=this._map.getZoom(),e=0;e<this.options.zoomIntervals.length;e++)if(t>=this.options.zoomIntervals[e].start&&t<=this.options.zoomIntervals[e].end){this.options.interval=this.options.zoomIntervals[e].interval;break}this.constructLines(this.getMins(),this.getLineCounts()),this.options.showOriginLabel&&this.addLayer(this.addOriginLabel())}return this},getLineCounts:function(){var t=Math.cos(this._bounds.getCenter().lat*Math.PI/180),e=6378137*Math.PI,i=this.options.interval,n=180*i/(e*t),o=180*i/e;return{x:Math.ceil((this._bounds.getEast()-this._bounds.getWest())/n),y:Math.ceil((this._bounds.getNorth()-this._bounds.getSouth())/o)}},getMins:function(){var t=Math.cos(this._bounds.getCenter().lat*Math.PI/180),e=6378137*Math.PI,i=this.options.interval,n=180*i/(e*t),o=180*i/e;return{x:Math.round((this._bounds.getWest()-Math.round(this._bounds.getWest()))/n)*n+Math.round(this._bounds.getWest()),y:Math.round(this._bounds.getSouth()/o)*o}},constructLines:function(t,e){for(var i=new Array(e.x+e.y),n=new Array(e.x+e.y),o=Math.cos(this._bounds.getCenter().lat*Math.PI/180),s=6378137*Math.PI,a=this.options.interval,r=180*a/(s*o),l=180*a/s,h=0;h<=e.x;h++){var d=t.x+h*r;i[h]=this.buildXLine(d),this.options.showOriginLabel||(n[h]=this.buildLabel("gridlabel-horiz",d))}for(var p=0;p<=e.y;p++){var c=t.y+p*l;i[p+h]=this.buildYLine(c),this.options.showOriginLabel||(n[p+h]=this.buildLabel("gridlabel-vert",c))}i.forEach(this.addLayer,this),this.options.showOriginLabel||n.forEach(this.addLayer,this)},buildXLine:function(t){var e=new L.LatLng(this._bounds.getSouth(),t),i=new L.LatLng(this._bounds.getNorth(),t);return new L.Polyline([e,i],this.lineStyle)},buildYLine:function(t){var e=new L.LatLng(t,this._bounds.getWest()),i=new L.LatLng(t,this._bounds.getEast());return new L.Polyline([e,i],this.lineStyle)},buildLabel:function(t,e){var i,n=this._map.getBounds().pad(-0);return i="gridlabel-horiz"===t?new L.LatLng(n.getCenter().lng,e):new L.LatLng(e,n.getCenter().lat),L.marker(i,{clickable:!1,icon:L.divIcon({iconSize:[0,0],className:"leaflet-grid-label",html:'<div class="'+t+'">'+e+"</div>"})})},addOriginLabel:function(){return L.marker([0,0],{clickable:!1,icon:L.divIcon({iconSize:[0,0],className:"leaflet-grid-label",html:'<div class="gridlabel-horiz">(0,0)</div>'})})}}),L.simpleGraticule=function(t){return new L.SimpleGraticule(t)},L.Map.addInitHook(function(){this.options.simpleGraticule&&(this.options.simpleGraticule=(new L.simpleGraticule).addTo(this))}),L.SnapGrid=L.LayerGroup.extend({options:{interval:20,showOriginLabel:!1,redraw:"move",hidden:!1,zoomIntervals:[]},lineStyle:{stroke:!0,color:"red",opacity:.3,weight:1,clickable:!1,dashArray:"8,2"},initialize:function(t){L.LayerGroup.prototype.initialize.call(this),L.Util.setOptions(this,t)},onAdd:function(t){this._map=t;var e=this.redraw();this._map.on("viewreset "+this.options.redraw,e.redraw,e),this.eachLayer(t.addLayer,t)},onRemove:function(t){t.off("viewreset "+this.options.redraw,this.map),this.eachLayer(this.removeLayer,this),this.options.simpleGraticule=!1},hide:function(){this.options.hidden=!0,this.redraw()},show:function(){this.options.hidden=!1,this.redraw()},redraw:function(){if(this._bounds=this._map.getBounds().pad(0),this.clearLayers(),!this.options.hidden){var t=this.getLineCounts();t.x+t.y<300&&this.constructLines(this.getMins(),this.getLineCounts()),this.options.showOriginLabel&&this.addLayer(this.addOriginLabel())}return this},getLineCounts:function(){var t=Math.cos(this._bounds.getCenter().lat*Math.PI/180),e=6378137*Math.PI,i=this.options.interval,n=180*i/(e*t),o=180*i/e;return{x:Math.ceil((this._bounds.getEast()-this._bounds.getWest())/n),y:Math.ceil((this._bounds.getNorth()-this._bounds.getSouth())/o)}},getMins:function(){var t=Math.cos(this._bounds.getCenter().lat*Math.PI/180),e=6378137*Math.PI,i=this.options.interval,n=180*i/(e*t),o=180*i/e;return{x:Math.round((this._bounds.getWest()-Math.round(this._bounds.getWest()))/n)*n+Math.round(this._bounds.getWest()),y:Math.round(this._bounds.getSouth()/o)*o}},constructLines:function(t,e){for(var i=new Array(e.x+e.y),n=new Array(e.x+e.y),o=Math.cos(this._bounds.getCenter().lat*Math.PI/180),s=6378137*Math.PI,a=this.options.interval,r=180*a/(s*o),l=180*a/s,h=0;h<=e.x;h++){var d=t.x+h*r;i[h]=this.buildXLine(d),this.options.showOriginLabel||(n[h]=this.buildLabel("gridlabel-horiz",d))}for(var p=0;p<=e.y;p++){var c=t.y+p*l;i[p+h]=this.buildYLine(c),this.options.showOriginLabel||(n[p+h]=this.buildLabel("gridlabel-vert",c))}i.forEach(this.addLayer,this),this.options.showOriginLabel&&n.forEach(this.addLayer,this)},buildXLine:function(t){var e=new L.LatLng(this._bounds.getSouth(),t),i=new L.LatLng(this._bounds.getNorth(),t);return new L.Polyline([e,i],this.lineStyle)},buildYLine:function(t){var e=new L.LatLng(t,this._bounds.getWest()),i=new L.LatLng(t,this._bounds.getEast());return new L.Polyline([e,i],this.lineStyle)},buildLabel:function(t,e){var i,n=this._map.getBounds().pad(-0);return i="gridlabel-horiz"===t?new L.LatLng(n.getCenter().lng,e):new L.LatLng(e,n.getCenter().lat),L.marker(i,{clickable:!1,icon:L.divIcon({iconSize:[0,0],className:"leaflet-snap-grid-label",html:'<div class="'+t+'">'+e+"</div>"})})},addOriginLabel:function(){return L.marker([0,0],{clickable:!1,icon:L.divIcon({iconSize:[0,0],className:"leaflet-snap-grid-label",html:'<div class="gridlabel-horiz">(0,0)</div>'})})}}),L.snapGrid=function(t){return new L.SnapGrid(t)},L.Map.addInitHook(function(){this.options.snapGrid&&(this.options.snapGrid=(new L.snapGrid).addTo(this))}),function(e){var i;if("function"==typeof define&&define.amd)define(["leaflet"],e);else if("undefined"!=typeof module)i=require("leaflet"),module.exports=e(i);else{if("undefined"==typeof t.L)throw new Error("Leaflet must be loaded first");e(t.L)}}(function(t){t.Map.mergeOptions({contextmenu:!0,contextmenuWidth:140,contextmenuItems:[{text:"Center map here",callback:function(t){this.panTo(t.latlng)}}]}),t.Map.ContextMenu=t.Handler.extend({_touchstart:t.Browser.msPointer?"MSPointerDown":t.Browser.pointer?"pointerdown":"touchstart",statics:{BASE_CLS:"leaflet-contextmenu"},initialize:function(e){t.Handler.prototype.initialize.call(this,e),this._map=e,this._items=[],this._visible=!1;var i=this._container=t.DomUtil.create("div",t.Map.ContextMenu.BASE_CLS,e._container);i.style.zIndex=1e4,i.style.position="absolute",e.options.contextmenuWidth&&(i.style.width=e.options.contextmenuWidth+"px"),this._createItems(),t.DomEvent.on(i,"click",t.DomEvent.stop).on(i,"mousedown",t.DomEvent.stop).on(i,"dblclick",t.DomEvent.stop).on(i,"contextmenu",t.DomEvent.stop)},addHooks:function(){t.DomEvent.on(e,t.Browser.touch?this._touchstart:"mousedown",this._onMouseDown,this).on(e,"keydown",this._onKeyDown,this),this._map.on({contextmenu:this._show,mousedown:this._hide,movestart:this._hide,zoomstart:this._hide},this),t.DomEvent.on(this._map.getContainer(),"mouseleave",this._hide,this)},removeHooks:function(){t.DomEvent.off(e,t.Browser.touch?this._touchstart:"mousedown",this._onMouseDown,this).off(e,"keydown",this._onKeyDown,this),this._map.off({contextmenu:this._show,mousedown:this._hide,movestart:this._hide,zoomstart:this._hide},this),t.DomEvent.off(this._map.getContainer(),"mouseleave",this._hide,this)},showAt:function(e,i){e instanceof t.LatLng&&(e=this._map.latLngToContainerPoint(e)),this._showAtPoint(e,i)},hide:function(){this._hide()},addItem:function(t){return this.insertItem(t)},insertItem:function(t,e){e=e!==i?e:this._items.length;var n=this._createItem(this._container,t,e);return this._items.push(n),this._sizeChanged=!0,this._map.fire("contextmenu.additem",{contextmenu:this,el:n.el,index:e}),n.el},removeItem:function(e){var i=this._container;isNaN(e)||(e=i.children[e]),e&&(this._removeItem(t.Util.stamp(e)),this._sizeChanged=!0,this._map.fire("contextmenu.removeitem",{contextmenu:this,el:e}))},removeAllItems:function(){for(var e;this._container.children.length;)e=this._container.children[0],this._removeItem(t.Util.stamp(e))},hideAllItems:function(){var t,e,i;for(e=0,i=this._items.length;i>e;e++)t=this._items[e],t.el.style.display="none"},showAllItems:function(){var t,e,i;for(e=0,i=this._items.length;i>e;e++)t=this._items[e],t.el.style.display=""},setDisabled:function(e,i){var n=this._container,o=t.Map.ContextMenu.BASE_CLS+"-item";isNaN(e)||(e=n.children[e]),e&&t.DomUtil.hasClass(e,o)&&(i?(t.DomUtil.addClass(e,o+"-disabled"),this._map.fire("contextmenu.disableitem",{contextmenu:this,el:e})):(t.DomUtil.removeClass(e,o+"-disabled"),this._map.fire("contextmenu.enableitem",{contextmenu:this,el:e})))},isVisible:function(){return this._visible},_createItems:function(){var t,e,i=this._map.options.contextmenuItems;for(t=0,e=i.length;e>t;t++)this._items.push(this._createItem(this._container,i[t]))},_createItem:function(e,i,n){if(i.separator||"-"===i)return this._createSeparator(e,n);var o=t.Map.ContextMenu.BASE_CLS+"-item",s=i.disabled?o+" "+o+"-disabled":o,a=this._insertElementAt("a",s,e,n),r=this._createEventHandler(a,i.callback,i.context,i.hideOnSelect),l="";return i.icon?l='<img class="'+t.Map.ContextMenu.BASE_CLS+'-icon" src="'+i.icon+'"/>':i.iconCls&&(l='<span class="'+t.Map.ContextMenu.BASE_CLS+"-icon "+i.iconCls+'"></span>'),a.innerHTML=l+i.text,a.href="#",t.DomEvent.on(a,"mouseover",this._onItemMouseOver,this).on(a,"mouseout",this._onItemMouseOut,this).on(a,"mousedown",t.DomEvent.stopPropagation).on(a,"click",r),{id:t.Util.stamp(a),el:a,callback:r}},_removeItem:function(e){var i,n,o,s;for(o=0,s=this._items.length;s>o;o++)if(i=this._items[o],i.id===e){n=i.el;var a=i.callback;return a&&t.DomEvent.off(n,"mouseover",this._onItemMouseOver,this).off(n,"mouseover",this._onItemMouseOut,this).off(n,"mousedown",t.DomEvent.stopPropagation).off(n,"click",i.callback),this._container.removeChild(n),this._items.splice(o,1),i}return null},_createSeparator:function(e,i){var n=this._insertElementAt("div",t.Map.ContextMenu.BASE_CLS+"-separator",e,i);return{id:t.Util.stamp(n),el:n}},_createEventHandler:function(e,n,o,s){var a=this,r=this._map,l=t.Map.ContextMenu.BASE_CLS+"-item-disabled";return s=s!==i?s:!0,function(){t.DomUtil.hasClass(e,l)||(s&&a._hide(),n&&n.call(o||r,a._showLocation),a._map.fire("contextmenu:select",{contextmenu:a,el:e}))}},_insertElementAt:function(t,n,o,s){var a,r=e.createElement(t);return r.className=n,s!==i&&(a=o.children[s]),a?o.insertBefore(r,a):o.appendChild(r),r},_show:function(t){this._showAtPoint(t.containerPoint)},_showAtPoint:function(e,i){if(this._items.length){var n=this._map,o=n.containerPointToLayerPoint(e),s=n.layerPointToLatLng(o),a={contextmenu:this};i&&(a=t.extend(i,a)),this._showLocation={latlng:s,layerPoint:o,containerPoint:e},this._setPosition(e),this._visible?this._setPosition(e):(this._container.style.display="block",this._visible=!0),this._map.fire("contextmenu.show",a)}},_hide:function(){this._visible&&(this._visible=!1,this._container.style.display="none",this._map.fire("contextmenu.hide",{contextmenu:this}))},_setPosition:function(e){var i,n=this._map.getSize(),o=this._container,s=this._getElementSize(o);this._map.options.contextmenuAnchor&&(i=t.point(this._map.options.contextmenuAnchor),e=e.add(i)),o._leaflet_pos=e,e.x+s.x>n.x?(o.style.left="auto",o.style.right=Math.max(n.x-e.x,0)+"px"):(o.style.left=Math.max(e.x,0)+"px",o.style.right="auto"),e.y+s.y>n.y?(o.style.top="auto",o.style.bottom=Math.max(n.y-e.y,0)+"px"):(o.style.top=Math.max(e.y,0)+"px",o.style.bottom="auto")},_getElementSize:function(t){var e=this._size,i=t.style.display;return(!e||this._sizeChanged)&&(e={},t.style.left="-999999px",t.style.right="auto",t.style.display="block",e.x=t.offsetWidth,e.y=t.offsetHeight,t.style.left="auto",t.style.display=i,this._sizeChanged=!1),e},_onMouseDown:function(){this._hide()},_onKeyDown:function(t){var e=t.keyCode;27===e&&this._hide()},_onItemMouseOver:function(e){t.DomUtil.addClass(e.target||e.srcElement,"over")},_onItemMouseOut:function(e){t.DomUtil.removeClass(e.target||e.srcElement,"over")}}),t.Map.addInitHook("addHandler","contextmenu",t.Map.ContextMenu),t.Mixin.ContextMenu={bindContextMenu:function(e){return t.setOptions(this,e),this._initContextMenu(),this},unbindContextMenu:function(){return this.off("contextmenu",this._showContextMenu,this),this},_initContextMenu:function(){this._items=[],this.on("contextmenu",this._showContextMenu,this)},_showContextMenu:function(t){var e,i,n,o;if(this._map.contextmenu){for(i=this._map.mouseEventToContainerPoint(t.originalEvent),this.options.contextmenuInheritItems||this._map.contextmenu.hideAllItems(),n=0,o=this.options.contextmenuItems.length;o>n;n++)e=this.options.contextmenuItems[n],this._items.push(this._map.contextmenu.insertItem(e,e.index));this._map.once("contextmenu.hide",this._hideContextMenu,this),this._map.contextmenu.showAt(i,{relatedTarget:this})}},_hideContextMenu:function(){var t,e;for(t=0,e=this._items.length;e>t;t++)this._map.contextmenu.removeItem(this._items[t]);this._items.length=0,this.options.contextmenuInheritItems||this._map.contextmenu.showAllItems()}};var n,o,s,a=[t.Marker,t.Path],r={contextmenu:!1,contextmenuItems:[],contextmenuInheritItems:!0},l=function(){this.options.contextmenu&&this._initContextMenu()};for(o=0,s=a.length;s>o;o++)n=a[o],n.prototype.options?n.mergeOptions(r):n.prototype.options=r,n.addInitHook(l),n.include(t.Mixin.ContextMenu);return t.Map.ContextMenu}),L.Control.SlideMenu=L.Control.extend({options:{isOpen:!1,position:"topright",width:"100%",height:"40px",delay:"0",closeButtonIcon:"fa-angle-double-up",menuButtonIcon:"fa-angle-double-down"},contents:['<span class="leaflet-top-menu-spacer">&nbsp;</span>','<a class="leaflet-top-menu-link"><b> Load </b></a>','<a class="leaflet-top-menu-link"><b> Save </b></a>','<a class="leaflet-top-menu-link"><b> Options </b></a>'],initialize:function(t,e){e&&L.Util.setOptions(this,e),t?this._innerHTML=t:this._innerHTML=this.contents.join(""),this._startPosition=0,this._isLeftPosition="topleft"===this.options.position||"buttomleft"===this.options.position?!0:!1},onAdd:function(t){this._map=t,this._startPosition=-parseInt(this.options.width,10),this.options.width.indexOf("%")+1&&(this._startPosition=this._startPosition*t.getSize().x*.01),this._container=L.DomUtil.create("div","leaflet-control-slidemenu leaflet-bar leaflet-control");var i=L.DomUtil.create("a","leaflet-bar-part leaflet-bar-part-single",this._container);i.title="Menu",this.options.menuButtonIcon.length>0?L.DomUtil.create("span","fa "+this.options.menuButtonIcon,i):L.DomUtil.create("span","fa fa-bars",i),this._menu=L.DomUtil.create("div","leaflet-menu",e.getElementsByClassName("leaflet-container")[0]),this._menu.style.width=this.options.width,this._menu.style.height=this.options.height;var n=L.DomUtil.create("span","leaflet-menu-close-button fa",this._menu);return this.options.closeButtonIcon.length>0?(this._isLeftPosition=!0,this._menu.style.left="-"+this.options.width,n.style["float"]="right",L.DomUtil.addClass(n,this.options.closeButtonIcon)):this._isLeftPosition?(this._menu.style.left="-"+this.options.width,n.style["float"]="right",L.DomUtil.addClass(n,"fa-chevron-left")):(n.style["float"]="left",this._menu.style.right="-"+this.options.width,L.DomUtil.addClass(n,"fa-chevron-right")),this._contents=L.DomUtil.create("div","leaflet-menu-contents",this._menu),this._contents.innerHTML=this._innerHTML,L.DomEvent.addListener(this._contents.getElementsByTagName("A")[0],"click",function(){this._map.RSWEIndoor.loadDialog.open()},this),L.DomEvent.addListener(this._contents.getElementsByTagName("A")[1],"click",function(){this._map.RSWEIndoor.saveDialog.open()},this),L.DomEvent.addListener(this._contents.getElementsByTagName("A")[2],"click",function(){this._map.RSWEIndoor.optionsDialog.open()},this),L.DomEvent.disableClickPropagation(this._menu),L.DomEvent.on(i,"click",L.DomEvent.stopPropagation).on(i,"click",function(){this._animate(this._menu,this._startPosition,0,!0)},this).on(n,"click",L.DomEvent.stopPropagation).on(n,"click",function(){this._animate(this._menu,0,this._startPosition,!1)},this),this.options.isOpen?this._animate(this._menu,this._startPosition,0,!0):this._animate(this._menu,0,this._startPosition,!1),this._container},setContents:function(t){this._innerHTML=t},_animate:function(t,e,i,n){if(this.options.isOpen=n,n||(this._startPosition=-parseInt(this.options.width,10),this.options.width.indexOf("%")+1&&(this._startPosition=this._startPosition*this._map.getSize().x*.01),this._menu.style.width=this.options.width,e=0,i=this._startPosition),this.options.delay>0){if(n?e>i:i>e)return;this._isLeftPosition?t.style.left=e+"px":t.style.right=e+"px",setTimeout(function(t){var o=n?e+10:e-10;e.indexOf("%")+1&&(o+="%"),t._animate(t._menu,o,i,n)},this.options.delay,this)}else this._isLeftPosition?t.style.left=i+"px":t.style.right=i+"px",this._map.getSize().x===-i&&(this._isLeftPosition?t.style.left="-100%":t.style.right="100%")}}),L.control.slideMenu=function(t,e){return new L.Control.SlideMenu(t,e)},L.Control.RSWEIndoor=L.Control.extend({options:{position:"topleft",contextmenu:!0,contextmenuWidth:140,contextmenuItems:[{text:"Center map here",callback:function(t){this._map.panTo(t.latlng)}}],layers:[],roomProps:[],roomWallsProps:[],controlLayerGrp:{},drawnWallsLayerGrp:{},fitBondsAfterLoad:!0,wallWidth:.1,snapOptions:{displaySnapGrid:!0,gridStep:.1,snapWallsToGrid:!0,snapWindowsToGrid:!1,snapDoorsToGrid:!1,snapWallsToObjects:!1,snapWindowsToObjects:!0,snapDoorsToObjects:!0,snapLayersArray:[]}},DeleteRoom:function(t){var e,i,n;for(i=0;i<this.options.layers.length;i++)if(t===this.options.layers[i].controlLayer){for(n=0;n<this.options.roomWallsProps[i].length;n++)delete this.options.roomWallsProps[i][n];for(n=0;n<this.options.layers[i].roomWalls.length;n++)e=this.options.layers[i].roomWalls[n],this.options.drawnWallsLayerGrp.removeLayer(e._leaflet_id);this.options.controlLayerGrp.removeLayer(t._leaflet_id),this.options.layers[i].roomWalls.length=0,this.options.layers.splice(i,1),this.options.roomProps.splice(i,1),this.options.roomWallsProps.splice(i,1);break}for(var o=0,s=this.options.snapOptions.snapLayersArray.length;s>o;o++)if(L.stamp(t)===L.stamp(this.options.snapOptions.snapLayersArray[o])){this.options.snapOptions.snapLayersArray.splice(o,1);break}},RedrawRoom:function(t,e){var n="undefined";if(t instanceof L.Rectangle?n="rectangle":t instanceof L.Polygon?n="polygon":t instanceof L.Polyline?n="polyline":t instanceof L.Circle?n="circle":t instanceof L.Marker&&(n="marker"),e&&(t.options.layerType=e),"circle"===n)return void this.options.controlLayerGrp.addLayer(t);if("marker"===n)return t.bindPopup("A popup!"),this.options.controlLayerGrp.addLayer(t),t.snapediting=new L.Handler.MarkerSnap(map,t),t.snapediting.addGuideLayer(this.options.controlLayerGrp),void t.snapediting.enable();var o,s,a,r,l,h,d=.5*this.options.wallWidth,p=0,c=0;for(p=0;p<this.options.layers.length;p++)if(t===this.options.layers[p].controlLayer){for(a=0;a<this.options.layers[p].roomWalls.length;a++)o=this.options.layers[p].roomWalls[a],this.options.drawnWallsLayerGrp.removeLayer(o._leaflet_id);this.options.layers[p].roomWalls.length=0;break}var u,g,_,f,m,y,b,v,w,k,C,M,T,S,D,x,E,O,P,G,I,W,z,R,U,B,H,A,F,N,j,Y,q,V,Z,X=t._latlngs,Q=X.length,K=0,J=0,$=function(t,e){return function(){this.ChangeWallType(t,e)}};if(Q>1){for(a=0;Q-1>a;a++)y=new L.LatLng(X[a%Q].lat,X[a%Q].lng),b=new L.LatLng(X[(a+1)%Q].lat,X[(a+1)%Q].lng),K=b.distanceTo(y),Math.abs(K)<1e-12&&(X.splice(),X.splice(a+1,1),a--,Q--);for(r=[],a=0;Q>a;a++)if(y=new L.LatLng(X[a%Q].lat,X[a%Q].lng),b=new L.LatLng(X[(a+1)%Q].lat,X[(a+1)%Q].lng),c=a,!(a>Q-2&&"polyline"===n)){m=0===a&&"polyline"===n?new L.LatLng(y.lat+y.lat-b.lat,y.lng+y.lng-b.lng):new L.LatLng(X[(a-1+Q)%Q].lat,X[(a-1+Q)%Q].lng),v=a===Q-2&&"polyline"===n?new L.LatLng(b.lat+b.lat-y.lat,b.lng+b.lng-y.lng):new L.LatLng(X[(a+2)%Q].lat,X[(a+2)%Q].lng),_=Math.cos(y.lat*Math.PI/180),f=Math.cos(b.lat*Math.PI/180),K=b.distanceTo(y),C=new L.LatLng(y.lat+(b.lng-y.lng)*(d/K*_),y.lng-(b.lat-y.lat)*(d/K/_)),M=new L.LatLng(y.lat-(b.lng-y.lng)*(d/K*_),y.lng+(b.lat-y.lat)*(d/K/_)),T=new L.LatLng(b.lat+(b.lng-y.lng)*(d/K*f),b.lng-(b.lat-y.lat)*(d/K/f)),S=new L.LatLng(b.lat-(b.lng-y.lng)*(d/K*f),b.lng+(b.lat-y.lat)*(d/K/f)),K=v.distanceTo(b),D=new L.LatLng(b.lat+(v.lng-b.lng)*(d/K*f),b.lng-(v.lat-b.lat)*(d/K/f)),x=new L.LatLng(b.lat-(v.lng-b.lng)*(d/K*f),b.lng+(v.lat-b.lat)*(d/K/f)),u=(b.lng-y.lng)*(v.lat-b.lat)-(v.lng-b.lng)*(b.lat-y.lat),g=(D.lng-T.lng)*(v.lat-b.lat)-(v.lng-b.lng)*(D.lat-T.lat),Math.abs(u)>1e-12?(P=new L.LatLng(g/u*(b.lat-y.lat)+T.lat,g/u*(b.lng-y.lng)+T.lng),K=b.distanceTo(P),J=b.distanceTo(T),P.lat=b.lat+(P.lat-b.lat)*(J/K),P.lng=b.lng+(P.lng-b.lng)*(J/K)):P=new L.LatLng(T.lat,T.lng),u=(b.lng-y.lng)*(v.lat-b.lat)-(v.lng-b.lng)*(b.lat-y.lat),g=(x.lng-S.lng)*(v.lat-b.lat)-(v.lng-b.lng)*(x.lat-S.lat),Math.abs(u)>1e-12?(G=new L.LatLng(g/u*(b.lat-y.lat)+S.lat,g/u*(b.lng-y.lng)+S.lng),K=b.distanceTo(G),J=b.distanceTo(S),G.lat=b.lat+(G.lat-b.lat)*(J/K),G.lng=b.lng+(G.lng-b.lng)*(J/K)):G=new L.LatLng(S.lat,S.lng),K=y.distanceTo(m),w=new L.LatLng(y.lat+(y.lng-m.lng)*(d/K*_),y.lng-(y.lat-m.lat)*(d/K/_)),k=new L.LatLng(y.lat-(y.lng-m.lng)*(d/K*_),y.lng+(y.lat-m.lat)*(d/K/_)),u=(y.lng-m.lng)*(b.lat-y.lat)-(b.lng-y.lng)*(y.lat-m.lat),g=(C.lng-w.lng)*(b.lat-y.lat)-(b.lng-y.lng)*(C.lat-w.lat),Math.abs(u)>1e-12?(E=new L.LatLng(g/u*(y.lat-m.lat)+w.lat,g/u*(y.lng-m.lng)+w.lng),K=y.distanceTo(E),J=y.distanceTo(C),E.lat=y.lat+(E.lat-y.lat)*(J/K),E.lng=y.lng+(E.lng-y.lng)*(J/K)):E=new L.LatLng(w.lat,w.lng),u=(y.lng-m.lng)*(b.lat-y.lat)-(b.lng-y.lng)*(y.lat-m.lat),g=(M.lng-k.lng)*(b.lat-y.lat)-(b.lng-y.lng)*(M.lat-k.lat),Math.abs(u)>1e-12?(O=new L.LatLng(g/u*(y.lat-m.lat)+k.lat,g/u*(y.lng-m.lng)+k.lng),K=y.distanceTo(O),J=y.distanceTo(M),O.lat=y.lat+(O.lat-y.lat)*(J/K),O.lng=y.lng+(O.lng-y.lng)*(J/K)):O=new L.LatLng(k.lat,k.lng),this.options.layers[p]===i&&(this.options.layers[p]={}),this.options.roomProps[p]===i&&this.options.roomProps.push({}),h=this.options.roomProps[p],h.layerClass=n,h.layerClassOptions=t.options,h.layerLatlngs=t.getLatLngs(),this.options.roomWallsProps[p]===i&&this.options.roomWallsProps.push([]),l=this.options.roomWallsProps[p],l[c]||(l[c]={wallType:"wall"},"wall"===e&&(l[c].wallType="wall"),"window"===e&&(l[c].wallType="window"),"door"===e&&(l[c].wallType="door1")),q=0,V=100,Z=l[c].wallType,I=new L.LatLng(y.lat*(1-.01*q)+.01*b.lat*q,y.lng*(1-.01*q)+b.lng*q*.01),W=new L.LatLng(y.lat*(1-.01*V)+.01*b.lat*V,y.lng*(1-.01*V)+.01*b.lng*V),z=new L.LatLng(C.lat*(1-.01*q)+.01*T.lat*q,C.lng*(1-.01*q)+T.lng*q*.01),R=new L.LatLng(M.lat*(1-.01*q)+.01*S.lat*q,M.lng*(1-.01*q)+.01*S.lng*q),U=new L.LatLng(C.lat*(1-.01*V)+.01*T.lat*V,C.lng*(1-.01*V)+.01*T.lng*V),B=new L.LatLng(M.lat*(1-.01*V)+.01*S.lat*V,M.lng*(1-.01*V)+.01*S.lng*V),A=new L.LatLng(I.lat+(W.lng-I.lng)*(.5*_),I.lng-(W.lat-I.lat)*(.5/_)),F=new L.LatLng(I.lat-(W.lng-I.lng)*(.5*_),I.lng+(W.lat-I.lat)*(.5/_)),j=new L.LatLng(W.lat+(W.lng-I.lng)*(.5*f),W.lng-(W.lat-I.lat)*(.5/f)),Y=new L.LatLng(W.lat-(W.lng-I.lng)*(.5*f),W.lng+(W.lat-I.lat)*(.5/f)),H=new L.LatLng(I.lat+(W.lng-z.lng)*(.5*Math.sqrt(3))*_+.5*(W.lat-I.lat),I.lng-(W.lat-I.lat)*(.5*Math.sqrt(3)/_)+.5*(W.lng-I.lng)),N=new L.LatLng(I.lat-(W.lng-I.lng)*(.5*Math.sqrt(3))*_+.5*(W.lat-I.lat),I.lng+(W.lat-I.lat)*(.5*Math.sqrt(3)/_)+.5*(W.lng-I.lng)),
this.options.controlLayerGrp.addLayer(t);for(var tt=0,et=this.options.snapOptions.snapLayersArray.length;et>tt&&L.stamp(t)!==L.stamp(this.options.snapOptions.snapLayersArray[tt]);tt++);tt===et&&this.options.snapOptions.snapLayersArray.push(t),"wall"===Z?(s=new L.polygon([C,T,S,M],{color:"#000000",weight:1,opacity:0,fillOpacity:0}),this.options.drawnWallsLayerGrp.addLayer(s),s.bringToBack(),r.push(s),o=new L.polygon([C,T,S,M],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),this.options.drawnWallsLayerGrp.addLayer(o),o.bringToBack(),r.push(o),o=new L.polygon([b,P,T],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),this.options.drawnWallsLayerGrp.addLayer(o),o.bringToBack(),r.push(o),o=new L.polygon([b,G,S],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),this.options.drawnWallsLayerGrp.addLayer(o),o.bringToBack(),r.push(o),o=new L.polygon([y,E,C],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),this.options.drawnWallsLayerGrp.addLayer(o),o.bringToBack(),r.push(o),o=new L.polygon([y,O,M],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),this.options.drawnWallsLayerGrp.addLayer(o),o.bringToBack(),r.push(o)):"gap"===Z?(s=new L.polygon([C,T,S,M],{color:"#000000",weight:1,opacity:0,fillOpacity:0}),this.options.drawnWallsLayerGrp.addLayer(s),s.bringToBack(),r.push(s),o=new L.polygon([M,R,z,C],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),this.options.drawnWallsLayerGrp.addLayer(o),o.bringToBack(),r.push(o),o=new L.polygon([S,B,U,T],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),this.options.drawnWallsLayerGrp.addLayer(o),o.bringToBack(),r.push(o),o=new L.polygon([z,R,B,U],{color:"#dddddd",weight:1,opacity:1,fillOpacity:1}),this.options.drawnWallsLayerGrp.addLayer(o),o.bringToBack(),r.push(o),o=new L.polygon([b,P,T],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),this.options.drawnWallsLayerGrp.addLayer(o),o.bringToBack(),r.push(o),o=new L.polygon([b,G,S],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),this.options.drawnWallsLayerGrp.addLayer(o),o.bringToBack(),r.push(o),o=new L.polygon([y,E,C],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),this.options.drawnWallsLayerGrp.addLayer(o),o.bringToBack(),r.push(o),o=new L.polygon([y,O,M],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),this.options.drawnWallsLayerGrp.addLayer(o),o.bringToBack(),r.push(o)):"window"===Z?(o=new L.polygon([C,z,R,M],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),this.options.drawnWallsLayerGrp.addLayer(o),o.bringToBack(),r.push(o),o=new L.polygon([S,B,U,T],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),this.options.drawnWallsLayerGrp.addLayer(o),o.bringToBack(),r.push(o),o=new L.polygon([z,R,B,U],{color:"#ffffff",weight:1,opacity:1,fillOpacity:1}),this.options.drawnWallsLayerGrp.addLayer(o),o.bringToFront(),r.push(o),o=new L.polygon([b,P,T],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),this.options.drawnWallsLayerGrp.addLayer(o),o.bringToBack(),r.push(o),o=new L.polygon([b,G,S],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),this.options.drawnWallsLayerGrp.addLayer(o),o.bringToBack(),r.push(o),o=new L.polygon([y,E,C],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),this.options.drawnWallsLayerGrp.addLayer(o),o.bringToBack(),r.push(o),o=new L.polygon([y,O,M],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),this.options.drawnWallsLayerGrp.addLayer(o),o.bringToBack(),r.push(o),o=new L.Curve(["M",[I.lat,I.lng],"L",[W.lat,W.lng],"Z"],{color:"#000000",weight:1,opacity:.9,fillOpacity:.9}),this.options.drawnWallsLayerGrp.addLayer(o),o.bringToFront(),r.push(o),s=new L.polygon([C,T,S,M],{color:"#000000",weight:1,opacity:0,fillOpacity:0}),this.options.drawnWallsLayerGrp.addLayer(s),s.bringToFront(),r.push(s)):"door1"===Z?(o=new L.polygon([C,z,R,M],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),this.options.drawnWallsLayerGrp.addLayer(o),o.bringToBack(),r.push(o),o=new L.polygon([S,B,U,T],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),this.options.drawnWallsLayerGrp.addLayer(o),o.bringToBack(),r.push(o),o=new L.polygon([b,P,T],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),this.options.drawnWallsLayerGrp.addLayer(o),o.bringToBack(),r.push(o),o=new L.polygon([b,G,S],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),this.options.drawnWallsLayerGrp.addLayer(o),o.bringToBack(),r.push(o),o=new L.polygon([y,E,C],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),this.options.drawnWallsLayerGrp.addLayer(o),o.bringToBack(),r.push(o),o=new L.polygon([y,O,M],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),this.options.drawnWallsLayerGrp.addLayer(o),o.bringToBack(),r.push(o),o=new L.polygon([z,R,B,U],{color:"#dddddd",weight:1,opacity:1,fillOpacity:1}),this.options.drawnWallsLayerGrp.addLayer(o),o.bringToFront(),r.push(o),o=new L.Curve(["M",[I.lat,I.lng],"L",[H.lat,H.lng],"Q",[j.lat,j.lng],[W.lat,W.lng],"Z"],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),this.options.drawnWallsLayerGrp.addLayer(o),o.bringToFront(),r.push(o),s=new L.polygon([C,T,S,M],{color:"#000000",weight:1,opacity:0,fillOpacity:0}),this.options.drawnWallsLayerGrp.addLayer(s),s.bringToFront(),r.push(s)):"door2"===Z?(o=new L.polygon([C,z,R,M],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),this.options.drawnWallsLayerGrp.addLayer(o),o.bringToBack(),r.push(o),o=new L.polygon([S,B,U,T],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),this.options.drawnWallsLayerGrp.addLayer(o),o.bringToBack(),r.push(o),o=new L.polygon([b,P,T],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),this.options.drawnWallsLayerGrp.addLayer(o),o.bringToBack(),r.push(o),o=new L.polygon([b,G,S],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),this.options.drawnWallsLayerGrp.addLayer(o),o.bringToBack(),r.push(o),o=new L.polygon([y,E,C],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),this.options.drawnWallsLayerGrp.addLayer(o),o.bringToBack(),r.push(o),o=new L.polygon([y,O,M],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),this.options.drawnWallsLayerGrp.addLayer(o),o.bringToBack(),r.push(o),o=new L.polygon([z,R,B,U],{color:"#dddddd",weight:1,opacity:1,fillOpacity:1}),this.options.drawnWallsLayerGrp.addLayer(o),o.bringToFront(),r.push(o),o=new L.Curve(["M",[I.lat,I.lng],"L",[N.lat,N.lng],"Q",[Y.lat,Y.lng],[W.lat,W.lng],"Z"],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),this.options.drawnWallsLayerGrp.addLayer(o),o.bringToFront(),r.push(o),s=new L.polygon([C,T,S,M],{color:"#000000",weight:1,opacity:0,fillOpacity:0}),this.options.drawnWallsLayerGrp.addLayer(s),s.bringToFront(),r.push(s)):"door3"===Z?(o=new L.polygon([C,z,R,M],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),this.options.drawnWallsLayerGrp.addLayer(o),o.bringToBack(),r.push(o),o=new L.polygon([S,B,U,T],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),this.options.drawnWallsLayerGrp.addLayer(o),o.bringToBack(),r.push(o),o=new L.polygon([b,P,T],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),this.options.drawnWallsLayerGrp.addLayer(o),o.bringToBack(),r.push(o),o=new L.polygon([b,G,S],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),this.options.drawnWallsLayerGrp.addLayer(o),o.bringToBack(),r.push(o),o=new L.polygon([y,E,C],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),this.options.drawnWallsLayerGrp.addLayer(o),o.bringToBack(),r.push(o),o=new L.polygon([y,O,M],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),this.options.drawnWallsLayerGrp.addLayer(o),o.bringToBack(),r.push(o),o=new L.polygon([z,R,B,U],{color:"#dddddd",weight:1,opacity:1,fillOpacity:1}),this.options.drawnWallsLayerGrp.addLayer(o),o.bringToFront(),r.push(o),o=new L.Curve(["M",[W.lat,W.lng],"L",[H.lat,H.lng],"Q",[A.lat,A.lng],[I.lat,I.lng],"Z"],{color:"#000000",weight:1,opacity:.9,fillOpacity:.9}),this.options.drawnWallsLayerGrp.addLayer(o),o.bringToFront(),r.push(o),s=new L.polygon([C,T,S,M],{color:"#000000",weight:1,opacity:0,fillOpacity:0}),this.options.drawnWallsLayerGrp.addLayer(s),s.bringToFront(),r.push(s)):"door4"===Z&&(o=new L.polygon([C,z,R,M],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),this.options.drawnWallsLayerGrp.addLayer(o),o.bringToBack(),r.push(o),o=new L.polygon([S,B,U,T],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),this.options.drawnWallsLayerGrp.addLayer(o),o.bringToBack(),r.push(o),o=new L.polygon([b,P,T],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),this.options.drawnWallsLayerGrp.addLayer(o),o.bringToBack(),r.push(o),o=new L.polygon([b,G,S],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),this.options.drawnWallsLayerGrp.addLayer(o),o.bringToBack(),r.push(o),o=new L.polygon([y,E,C],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),this.options.drawnWallsLayerGrp.addLayer(o),o.bringToBack(),r.push(o),o=new L.polygon([y,O,M],{color:"#000000",weight:1,opacity:1,fillOpacity:1}),this.options.drawnWallsLayerGrp.addLayer(o),o.bringToBack(),r.push(o),o=new L.polygon([z,R,B,U],{color:"#dddddd",weight:1,opacity:1,fillOpacity:1}),this.options.drawnWallsLayerGrp.addLayer(o),o.bringToFront(),r.push(o),o=new L.Curve(["M",[W.lat,W.lng],"L",[N.lat,N.lng],"Q",[F.lat,F.lng],[I.lat,I.lng],"Z"],{color:"#000000",weight:1,opacity:.9,fillOpacity:.9}),this.options.drawnWallsLayerGrp.addLayer(o),o.bringToFront(),r.push(o),s=new L.polygon([C,T,S,M],{color:"#000000",weight:1,opacity:0,fillOpacity:0}),this.options.drawnWallsLayerGrp.addLayer(s),s.bringToFront(),r.push(s)),this.options.controlLayerGrp.bringToBack(),s.on("contextmenu",$(p,c),this)}this.options.roomWallsProps[p]=l,this.options.roomProps[p]=h,this.options.layers[p]={controlLayer:t,roomWalls:r}}this.options.drawnWallsLayerGrp.addTo(this._map)},ChangeWallType:function(t,e){if(this.options.layers[t].controlLayer&&this.options.roomWallsProps[t]){var i=this.options.roomWallsProps[t];if("wall"===i[e].wallType)i[e].wallType="gap";else if("gap"===i[e].wallType)i[e].wallType="wall";else if("door1"===i[e].wallType)i[e].wallType="door2";else if("door2"===i[e].wallType)i[e].wallType="door4";else if("door4"===i[e].wallType)i[e].wallType="door3";else{if("door3"!==i[e].wallType)return;i[e].wallType="door1"}this.RedrawRoom(this.options.layers[t].controlLayer,"undefined")}},SetSnapOptions:function(){this._map.drawControl.setDrawingOptions({wall:{snapType:"wall",gridStep:this.options.snapOptions.gridStep,snapToGrid:this.options.snapOptions.snapWallsToGrid,snapToObjects:this.options.snapOptions.snapWallsToObjects,guideLayers:this.options.snapOptions.snapLayersArray,snapDistance:6},window:{snapType:"window",gridStep:this.options.snapOptions.gridStep,snapToGrid:this.options.snapOptions.snapWindowsToGrid,snapToObjects:this.options.snapOptions.snapWindowsToObjects,guideLayers:this.options.snapOptions.snapLayersArray,snapDistance:6},door:{snapType:"door",gridStep:this.options.snapOptions.gridStep,snapToGrid:this.options.snapOptions.snapDoorsToGrid,snapToObjects:this.options.snapOptions.snapDoorsToObjects,guideLayers:this.options.snapOptions.snapLayersArray,snapDistance:6}})},getData:function(){var t={roomProps:this.options.roomProps,roomWallsProps:this.options.roomWallsProps};return JSON.stringify(t)},loadData:function(t){t||(t='{"roomProps":[],"roomWallsProps":[]}');var e;try{e=JSON.parse(t)}catch(i){return!1}return this.options.roomProps=[],this.options.roomWallsProps=[],this.options.layers=[],this.options.drawnWallsLayerGrp.clearLayers(),this.options.controlLayerGrp.clearLayers(),this.options.roomProps=e.roomProps,this.options.roomWallsProps=e.roomWallsProps,this.options.roomProps.forEach(function(t){var e;"polyline"===t.layerClass&&(e=new L.Polyline(t.layerLatlngs,t.layerClassOptions)),"polygon"===t.layerClass&&(e=new L.Polygon(t.layerLatlngs,t.layerClassOptions)),e&&(e.addTo(this._map),this.options.controlLayerGrp.addLayer(e),this.RedrawRoom(e))},this),this.options.fitBondsAfterLoad&&this.fitBounds(),this._map.fire("close_all_dialogs"),!0},fitBounds:function(){var t;this.options.controlLayerGrp.eachLayer(function(e){t=t?t.extend(e.getBounds()):e.getBounds()}),t&&this._map.fitBounds(t)},RSWEinit:function(){var t=this._map;if(!t)throw new Error("Leaflet has not properly initialized");var e;t.RSWEIndoor.options.controlLayerGrp=t.drawControl._toolbars.edit.options.featureGroup,t.RSWEIndoor.options.drawnWallsLayerGrp=new L.FeatureGroup,t.addLayer(t.RSWEIndoor.options.drawnWallsLayerGrp),t.options.snapGrid.options.interval=t.RSWEIndoor.options.snapOptions.gridStep,t.RSWEIndoor.options.snapOptions.displaySnapGrid?t.options.snapGrid.show():t.options.snapGrid.hide(),t.RSWEIndoor.SetSnapOptions(),t.on("close_all_dialogs",function(){t.RSWEIndoor.loadDialog.close(),t.RSWEIndoor.saveDialog.close(),t.RSWEIndoor.optionsDialog.close(),t.drawControl._toolbars.draw.disable(),t.drawControl._toolbars.edit.disable()}),t.on("draw:drawstart",function(n){e=n.layer,"marker"===n.layerType&&(e._mouseMarker.snapediting!==i&&(e._mouseMarker.snapediting.disable(),delete e._mouseMarker.snapediting),e._mouseMarker.snapediting=new L.Handler.MarkerSnap(t,e._mouseMarker),e._mouseMarker.snapediting._snapper._guides=t.RSWEIndoor.options.snapOptions.snapLayersArray,e._mouseMarker.snapediting.enable()),("wall"===n.layerType||"window"===n.layerType||"door"===n.layerType)&&(t.RSWEIndoor.SetSnapOptions(),e._poly.snapediting=new L.Handler.PolylineSnap(t,e._poly),e._poly.snapediting._snapper._guides=t.RSWEIndoor.options.snapOptions.snapLayersArray,e._poly.snapediting._snapper.options.gridStep=t.RSWEIndoor.options.snapOptions.gridStep,"wall"===n.layerType&&(e._poly.snapediting._snapper.options.snapToGrid=t.RSWEIndoor.options.snapOptions.snapWallsToGrid,e._poly.snapediting._snapper.options.snapToObjects=t.RSWEIndoor.options.snapOptions.snapWallsToObjects),"window"===n.layerType&&(e._poly.snapediting._snapper.options.snapToGrid=t.RSWEIndoor.options.snapOptions.snapWindowsToGrid,e._poly.snapediting._snapper.options.snapToObjects=t.RSWEIndoor.options.snapOptions.snapWindowsToObjects),"door"===n.layerType&&(e._poly.snapediting._snapper.options.snapToGrid=t.RSWEIndoor.options.snapOptions.snapDoorsToGrid,e._poly.snapediting._snapper.options.snapToObjects=t.RSWEIndoor.options.snapOptions.snapDoorsToObjects),e._poly.snapediting.enable())}),t.on("draw:editstart_after",function(){t.RSWEIndoor.options.controlLayerGrp.eachLayer(function(e){e.editing._poly!==i&&e.snapediting===i&&(t.removeLayer(e.editing._markerGroup),e.snapediting=new L.Handler.PolylineSnap(t,e),e.snapediting._snapper._guides=t.RSWEIndoor.options.snapOptions.snapLayersArray,e.snapediting._snapper.options.gridStep=t.RSWEIndoor.options.snapOptions.gridStep,"wall"===e.layerType&&(e.snapediting._snapper.options.snapToGrid=t.RSWEIndoor.options.snapOptions.snapWallsToGrid,e.snapediting._snapper.options.snapToObjects=t.RSWEIndoor.options.snapOptions.snapWallsToObjects),"window"===e.layerType&&(e.snapediting._snapper.options.snapToGrid=t.RSWEIndoor.options.snapOptions.snapWindowsToGrid,e.snapediting._snapper.options.snapToObjects=t.RSWEIndoor.options.snapOptions.snapWindowsToObjects),"door"===e.layerType&&(e.snapediting._snapper.options.snapToGrid=t.RSWEIndoor.options.snapOptions.snapDoorsToGrid,e.snapediting._snapper.options.snapToObjects=t.RSWEIndoor.options.snapOptions.snapDoorsToObjects),e.snapediting.enable())},t)}),t.on("draw:editstop",function(){t.RSWEIndoor.options.controlLayerGrp.eachLayer(function(t){t.editing._poly!==i&&t.snapediting!==i&&(t.snapediting.disable(),delete t.snapediting)},t)}),t.on("revert-edited",function(e){var i=e.layer;t.RSWEIndoor.RedrawRoom(i)}),t.on("edit",function(e){var i=e.layer;t.RSWEIndoor.RedrawRoom(i)}),t.on("draw:deleted",function(t){var e=t.layers._layers;for(var i in e)this.RSWEIndoor.DeleteRoom(e[i])}),t.on("draw:created",function(e){t.RSWEIndoor.RedrawRoom(e.layer,e.layerType)}),t.on("redraw:all",function(){t.RSWEIndoor.options.controlLayerGrp.eachLayer(function(e){t.RSWEIndoor.RedrawRoom(e)})})}}),L.Map.addInitHook(function(){if(this.options.RSWEIndoor){var t=new L.FeatureGroup;this.addLayer(t),this.drawControl=new L.Control.Draw({edit:{featureGroup:t}}),this.addControl(this.drawControl),this.RSWEIndoor=new L.Control.RSWEIndoor,this.RSWEIndoor._map=this,this.slideMenu=L.control.slideMenu("",{}),this.addControl(this.slideMenu),this.graphicScaleControl=L.control.graphicScale().addTo(this),this.options.simpleGraticule=(new L.simpleGraticule).addTo(this),this.options.snapGrid=(new L.snapGrid).addTo(this),this.RSWEIndoor.optionsDialog=new L.Control.Dialog.Options,this.addControl(this.RSWEIndoor.optionsDialog),this.RSWEIndoor.saveDialog=new L.Control.Dialog.Save,this.addControl(this.RSWEIndoor.saveDialog),this.RSWEIndoor.loadDialog=new L.Control.Dialog.Load,this.addControl(this.RSWEIndoor.loadDialog),this.RSWEIndoor.RSWEinit()}}),L.Control.Dialog=L.Control.extend({options:{size:[300,300],minSize:[100,100],maxSize:[350,350],anchor:[50,50],position:"topleft",initOpen:!1},initialize:function(t){L.setOptions(this,t),this._attributions={}},onAdd:function(t){return this._initLayout(),this._map=t,this.update(),this.options.initOpen||this.close(),this._container},open:function(){return this._map?(this._container.style.visibility="",this._map.fire("dialog:opened",this),this):void 0},close:function(){return this._container.style.visibility="hidden",this._map.fire("dialog:closed",this),this},destroy:function(){return this._map?(this.removeFrom(this._map),this.onRemove&&this.onRemove(this._map),this._map.fire("dialog:destroyed",this),this):this},setLocation:function(t){return t=t||[250,250],this.options.anchor[0]=0,this.options.anchor[1]=0,this._oldMousePos.x=0,this._oldMousePos.y=0,this._move(t[0],t[1]),this},setSize:function(t){return t=t||[300,300],this.options.size[0]=0,this.options.size[1]=0,this._oldMousePos.x=0,this._oldMousePos.y=0,this._resize(t[0],t[1]),this},lock:function(){return this._resizerNode.style.visibility="hidden",this._grabberNode.style.visibility="hidden",this._closeNode.style.visibility="hidden",this._map.fire("dialog:locked",this),this},unlock:function(){return this._resizerNode.style.visibility="",this._grabberNode.style.visibility="",this._closeNode.style.visibility="",this._map.fire("dialog:unlocked",this),this},freeze:function(){return this._resizerNode.style.visibility="hidden",this._grabberNode.style.visibility="hidden",this._map.fire("dialog:frozen",this),this},unfreeze:function(){return this._resizerNode.style.visibility="",this._grabberNode.style.visibility="",this._map.fire("dialog:unfrozen",this),this},setContent:function(t){return this._content=t,this.update(),this},getContent:function(){return this._content},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._container.style.visibility="",this._map.fire("dialog:updated",this))},_initLayout:function(){var t="leaflet-control-dialog",e=this._container=L.DomUtil.create("div",t);e.style.width=this.options.size[0]+"px",e.style.height=this.options.size[1]+"px",e.style.left=this.options.anchor[0]+"px",e.style.top=this.options.anchor[1]+"px";var i=L.DomEvent.stopPropagation;L.DomEvent.on(e,"click",i).on(e,"mousedown",i).on(e,"touchstart",i).on(e,"dblclick",i).on(e,"mousewheel",i).on(e,"contextmenu",i).on(e,"MozMousePixelScroll",i);var n=this._innerContainer=L.DomUtil.create("div",t+"-inner"),o=this._grabberNode=L.DomUtil.create("div",t+"-grabber");o.innerHTML="<b>&#8689;</b>",L.DomEvent.on(o,"mousedown",this._handleMoveStart,this);var s=this._closeNode=L.DomUtil.create("div",t+"-close");s.innerHTML="<b>X</b>",L.DomEvent.on(s,"click",this._handleClose,this);var a=this._resizerNode=L.DomUtil.create("div",t+"-resizer");a.innerHTML="<b>&#8690;</b>",L.DomEvent.on(a,"mousedown",this._handleResizeStart,this);var r=this._contentNode=L.DomUtil.create("div",t+"-contents");e.appendChild(n),n.appendChild(r),n.appendChild(o),n.appendChild(s),n.appendChild(a),this._oldMousePos={x:0,y:0}},_handleClose:function(){this.close()},_handleResizeStart:function(t){this._oldMousePos.x=t.clientX,this._oldMousePos.y=t.clientY,L.DomEvent.on(this._map,"mousemove",this._handleMouseMove,this),L.DomEvent.on(this._map,"mouseup",this._handleMouseUp,this),this._map.fire("dialog:resizestart",this),this._resizing=!0},_handleMoveStart:function(t){this._oldMousePos.x=t.clientX,this._oldMousePos.y=t.clientY,L.DomEvent.on(this._map,"mousemove",this._handleMouseMove,this),L.DomEvent.on(this._map,"mouseup",this._handleMouseUp,this),this._map.fire("dialog:movestart",this),this._moving=!0},_handleMouseMove:function(t){var e=t.originalEvent.clientX-this._oldMousePos.x,i=t.originalEvent.clientY-this._oldMousePos.y;t.originalEvent.stopPropagation&&t.originalEvent.stopPropagation(),t.originalEvent.preventDefault&&t.originalEvent.preventDefault(),this._resizing&&this._resize(e,i),this._moving&&this._move(e,i)},_handleMouseUp:function(){L.DomEvent.off(this._map,"mousemove",this._handleMouseMove,this),L.DomEvent.off(this._map,"mouseup",this._handleMouseUp,this),this._resizing&&(this._resizing=!1,this._map.fire("dialog:resizeend",this)),this._moving&&(this._moving=!1,this._map.fire("dialog:moveend",this))},_move:function(t,e){var i=this.options.anchor[0]+t,n=this.options.anchor[1]+e;this.options.anchor[0]=i,this.options.anchor[1]=n,this._container.style.left=this.options.anchor[0]+"px",this._container.style.top=this.options.anchor[1]+"px",this._map.fire("dialog:moving",this),this._oldMousePos.y+=e,this._oldMousePos.x+=t},_resize:function(t,e){var i=this.options.size[0]+t,n=this.options.size[1]+e;i<=this.options.maxSize[0]&&i>=this.options.minSize[0]&&(this.options.size[0]=i,this._container.style.width=this.options.size[0]+"px",this._oldMousePos.x+=t),n<=this.options.maxSize[1]&&n>=this.options.minSize[1]&&(this.options.size[1]=n,this._container.style.height=this.options.size[1]+"px",this._oldMousePos.y+=e),this._map.fire("dialog:resizing",this)},_updateContent:function(){if(this._content){var t=this._contentNode,e="function"==typeof this._content?this._content(this):this._content;if("string"==typeof e)t.innerHTML=e;else{for(;t.hasChildNodes();)t.removeChild(t.firstChild);t.appendChild(e)}}},_updateLayout:function(){this._container.style.width=this.options.size[0]+"px",this._container.style.height=this.options.size[1]+"px",this._container.style.left=this.options.anchor[0]+"px",this._container.style.top=this.options.anchor[1]+"px"}}),L.control.dialog=function(t){return new L.Control.Dialog(t)},L.Control.Dialog.Options=L.Control.Dialog.extend({options:{size:[300,300],minSize:[100,100],maxSize:[350,350],anchor:[50,50],position:"topleft",initOpen:!1},_isOpen:!1,initialize:function(){L.setOptions(this,this.options),L.Control.Dialog.prototype.initialize.call(this,this.options)},_getTabCount:function(){return this._container.firstChild.firstChild.firstChild.lastChild.childNodes.length},_getTab:function(t){return this._container.firstChild.firstChild.firstChild.lastChild.childNodes[t]},_getTabTitle:function(t){return this._container.firstChild.firstChild.firstChild.getElementsByTagName("UL")[0].childNodes[t]},_getTabContainer:function(t){return this._container.firstChild.firstChild.firstChild.lastChild.childNodes[t].childNodes[0]},_selectTab:function(t){for(var e=this._getTabCount(),i=0;e>i;i++){var n=this._getTab(i),o=this._getTabTitle(i);t!==i?(n.setAttribute("class","dialog-tab"),o.setAttribute("class","dialog-tab-title")):(n.setAttribute("class","dialog-tab selected"),o.setAttribute("class","dialog-tab-title selected-li"))}},onAdd:function(t){this._container=L.Control.Dialog.prototype.onAdd.call(this,t),this._map=t;var e=t.getSize();this.options.size=[Math.floor(.6*e.x),Math.floor(.6*e.y)],this.options.maxSize=[Math.floor(.6*e.x),Math.floor(.6*e.y)],this.options.anchor=[Math.floor(.2*e.x),Math.floor(.2*e.y)],this._isOpen=!1,L.setOptions(this,this.options);var i=this.contents.join("");this.setContent(i);for(var n=function(t){return function(){this._selectTab(t)}},o=this._getTabCount(),s=0;o>s;s++)L.DomEvent.addListener(this._getTabTitle(s),"click",n(s),this);return this._dlgCreateControls(),this.options.initOpen?this.open():this.close(),this._container},close:function(){this._isOpen=!1,L.Control.Dialog.prototype.close.call(this)},open:function(){this._map.fire("close_all_dialogs"),this._isOpen=!0,L.Control.Dialog.prototype.open.call(this)},contents:['<div class="dialog-container">','<ul class="dialog-tabs-title">','<li class="dialog-tab-title selected-li">View Options</li>','<li class="dialog-tab-title">Edit Options</li>','<li class="dialog-tab-title">Snap Options</li>',"</ul>",'<div class="dialog-tabs">','<div class="dialog-tab selected"><div class="dialog-tab-content"><h3>View Options</h3></div></div>','<div class="dialog-tab"><div class="dialog-tab-content"><h3>Edit Options</h3></div></div>','<div class="dialog-tab"><div class="dialog-tab-content"><h3>Snap Options</h3></div></div>',"</div>","</div>",""],_dlgCreateControls:function(){var t,e;t=this._getTabContainer(0),t&&(this._map.options.simpleGraticule!==i&&(e=L.DomUtil.create("div","display-grid-control"),t.appendChild(e),this._map.options.simpleGraticule.options.hidden===!1?e.innerHTML='<label><input type="checkbox" checked name="simpleGraticule" value="1" />Display Measure Grid</label>':e.innerHTML='<label><input type="checkbox" name="simpleGraticule" value="1" />Display Measure Grid</label>',L.DomEvent.addListener(e.firstChild.firstElementChild,"change",function(t){t.target.checked?this._map.options.simpleGraticule.show():this._map.options.simpleGraticule.hide()},this)),this._map.options.graphicScaleControl!==i&&(e=L.DomUtil.create("div","display-graphicscale-control"),t.appendChild(e),"none"===this._map.options.graphicScaleControl.style.display?e.innerHTML='<label><input type="checkbox" name="graphicScaleControl" value="1" />Display Ruler</label>':e.innerHTML='<label><input type="checkbox" checked name="graphicScaleControl" value="1" />Display Ruler</label>',L.DomEvent.addListener(e.firstChild.firstElementChild,"change",function(t){t.target.checked?this._map.options.graphicScaleControl.style.display="block":this._map.options.graphicScaleControl.style.display="none"},this)),this._map.RSWEIndoor.options.fitBondsAfterLoad!==i&&(e=L.DomUtil.create("div","display-graphicscale-control"),t.appendChild(e),this._map.RSWEIndoor.options.fitBondsAfterLoad===!0?e.innerHTML='<label><input type="checkbox" checked name="fitBondsAfterLoad" value="1" />Fit Bonds After Load</label>':e.innerHTML='<label><input type="checkbox" name="fitBondsAfterLoad" value="1" />Fit Bonds After Load</label>',L.DomEvent.addListener(e.firstChild.firstElementChild,"change",function(t){t.target.checked?this._map.RSWEIndoor.options.fitBondsAfterLoad=!0:this._map.RSWEIndoor.options.fitBondsAfterLoad=!1},this))),t=this._getTabContainer(1),t&&this._map.RSWEIndoor.options.wallWidth!==i&&(e=L.DomUtil.create("div","wallwidth-control"),t.appendChild(e),e.innerHTML='<label><input type="text" name="wallWidthControl" /> Wall Width (meters)</label>',e.firstChild.firstElementChild.setAttribute("value",this._map.RSWEIndoor.options.wallWidth),L.DomEvent.addListener(e.firstChild.firstElementChild,"change",function(t){if(t.target.value){var e=t.target.value.replace(new RegExp(",","g"),".");isNaN(e)?t.target.value=this._map.RSWEIndoor.options.wallWidth:(this._map.RSWEIndoor.options.wallWidth=e,t.target.value=e,this._map.fire("redraw:all"))}},this)),t=this._getTabContainer(2),t&&(this._map.RSWEIndoor.options.snapOptions.displaySnapGrid!==i&&(e=L.DomUtil.create("div","display-snap-grid-options-control"),t.appendChild(e),this._map.options.snapGrid.options.hidden===!0?e.innerHTML='<label><input type="checkbox" name="displaySnapGrid" value="1" /> Display Snap Grid</label>':e.innerHTML='<label><input type="checkbox" checked name="displaySnapGrid" value="1" /> Display Snap Grid</label>',L.DomEvent.addListener(e.firstChild.firstElementChild,"change",function(t){t.target.checked?(this._map.options.snapGrid.show(),this._map.RSWEIndoor.options.snapOptions.displaySnapGrid=!0):(this._map.options.snapGrid.hide(),this._map.RSWEIndoor.options.snapOptions.displaySnapGrid=!1)},this)),this._map.RSWEIndoor.options.snapOptions.gridStep!==i&&(e=L.DomUtil.create("div","snap-grid-step-options-control"),t.appendChild(e),e.innerHTML='<label><input type="text" name=snapgridstep" /> Snap Grid Step (meters)</label>',e.firstChild.firstElementChild.setAttribute("value",this._map.RSWEIndoor.options.snapOptions.gridStep),L.DomEvent.addListener(e.firstChild.firstElementChild,"change",function(t){if(t.target.value){var e=this.value.replace(new RegExp(",","g"),".");isNaN(e)?t.target.value=this._map.RSWEIndoor.options.snapOptions.gridStep:(e=+e,this._map.RSWEIndoor.options.snapOptions.gridStep=e,t.target.value=e,this._map.options.snapGrid.options.interval=e,this._map.RSWEIndoor.SetSnapOptions(),this._map.options.snapGrid.redraw(),this._map.RSWEIndoor.options.controlLayer.eachLayer(function(t){t.snapediting!==i&&t.snapediting._snapper!==i&&(t.snapediting._snapper.options.gridStep=e)}))}},this)),this._map.RSWEIndoor.options.snapOptions.snapWallsToGrid!==i&&(e=L.DomUtil.create("div","display-snap-grid-options-control"),t.appendChild(e),this._map.RSWEIndoor.options.snapOptions.snapWallsToGrid===!0?e.innerHTML='<label><input type="checkbox" checked name="snapWallsToGrid" value="1" /> Snap Walls To Grid</label>':e.innerHTML='<label><input type="checkbox" name="snapWallsToGrid" value="1" /> Snap Walls To Grid</label>',L.DomEvent.addListener(e.firstChild.firstElementChild,"change",function(t){t.target.checked?(this._map.RSWEIndoor.options.snapOptions.snapWallsToGrid=!0,this._map.RSWEIndoor.SetSnapOptions()):(this._map.RSWEIndoor.options.snapOptions.snapWallsToGrid=!1,this._map.RSWEIndoor.SetSnapOptions())},this)),this._map.RSWEIndoor.options.snapOptions.snapWallsToObjects!==i&&(e=L.DomUtil.create("div","display-snap-grid-options-control"),t.appendChild(e),this._map.RSWEIndoor.options.snapOptions.snapWallsToObjects===!0?e.innerHTML='<label><input type="checkbox" checked name="snapWallsToObjects" value="1" /> Snap Walls To Objects</label>':e.innerHTML='<label><input type="checkbox" name="snapWallsToObjects" value="1" /> Snap Walls To Objects</label>',L.DomEvent.addListener(e.firstChild.firstElementChild,"change",function(t){t.target.checked?(this._map.RSWEIndoor.options.snapOptions.snapWallsToObjects=!0,this._map.RSWEIndoor.SetSnapOptions()):(this._map.RSWEIndoor.options.snapOptions.snapWallsToObjects=!1,this._map.RSWEIndoor.SetSnapOptions())},this)),this._map.RSWEIndoor.options.snapOptions.snapWindowsToGrid!==i&&(e=L.DomUtil.create("div","display-snap-grid-options-control"),t.appendChild(e),this._map.RSWEIndoor.options.snapOptions.snapWindowsToGrid===!0?e.innerHTML='<label><input type="checkbox" checked name="snapWindowsToGrid" value="1" /> Snap Windows To Grid</label>':e.innerHTML='<label><input type="checkbox" name="snapWindowsToGrid" value="1" /> Snap Windows To Grid</label>',L.DomEvent.addListener(e.firstChild.firstElementChild,"change",function(t){t.target.checked?(this._map.RSWEIndoor.options.snapOptions.snapWindowsToGrid=!0,this._map.RSWEIndoor.SetSnapOptions()):(this._map.RSWEIndoor.options.snapOptions.snapWindowsToGrid=!1,this._map.RSWEIndoor.SetSnapOptions())},this)),this._map.RSWEIndoor.options.snapOptions.snapWindowsToObjects!==i&&(e=L.DomUtil.create("div","display-snap-grid-options-control"),t.appendChild(e),this._map.RSWEIndoor.options.snapOptions.snapWindowsToObjects===!0?e.innerHTML='<label><input type="checkbox" checked name="snapWindowsToObjects" value="1" /> Snap Windows To Objects</label>':e.innerHTML='<label><input type="checkbox" name="snapWindowsToObjects" value="1" /> Snap Windows To Objects</label>',L.DomEvent.addListener(e.firstChild.firstElementChild,"change",function(t){t.target.checked?(this._map.RSWEIndoor.options.snapOptions.snapWindowsToObjects=!0,this._map.RSWEIndoor.SetSnapOptions()):(this._map.RSWEIndoor.options.snapOptions.snapWindowsToObjects=!1,this._map.RSWEIndoor.SetSnapOptions())},this)),this._map.RSWEIndoor.options.snapOptions.snapDoorsToGrid!==i&&(e=L.DomUtil.create("div","display-snap-grid-options-control"),
t.appendChild(e),this._map.RSWEIndoor.options.snapOptions.snapDoorsToGrid===!0?e.innerHTML='<label><input type="checkbox" checked name="snapDoorsToGrid" value="1" /> Snap Doors To Grid</label>':e.innerHTML='<label><input type="checkbox" name="snapDoorsToGrid" value="1" /> Snap Doors To Grid</label>',L.DomEvent.addListener(e.firstChild.firstElementChild,"change",function(t){t.target.checked?(this._map.RSWEIndoor.options.snapOptions.snapDoorsToGrid=!0,this._map.RSWEIndoor.SetSnapOptions()):(this._map.RSWEIndoor.options.snapOptions.snapDoorsToGrid=!1,this._map.RSWEIndoor.SetSnapOptions())},this)),this._map.RSWEIndoor.options.snapOptions.snapDoorsToObjects!==i&&(e=L.DomUtil.create("div","display-snap-grid-options-control"),t.appendChild(e),this._map.RSWEIndoor.options.snapOptions.snapDoorsToObjects===!0?e.innerHTML='<label><input type="checkbox" checked name="snapDoorsToObjects" value="1" /> Snap Doors To Objects</label>':e.innerHTML='<label><input type="checkbox" name="snapDoorsToObjects" value="1" /> Snap Doors To Objects</label>',L.DomEvent.addListener(e.firstChild.firstElementChild,"change",function(t){t.target.checked?(this._map.RSWEIndoor.options.snapOptions.snapDoorsToObjects=!0,this._map.RSWEIndoor.SetSnapOptions()):(this._map.RSWEIndoor.options.snapOptions.snapDoorsToObjects=!1,this._map.RSWEIndoor.SetSnapOptions())},this)))}}),L.control.dialog.options=function(t){return new L.Control.Dialog.Options(t)},L.Control.Dialog.Save=L.Control.Dialog.extend({options:{size:[300,300],minSize:[100,100],maxSize:[350,350],anchor:[50,50],position:"topleft",initOpen:!1},_isOpen:!1,initialize:function(){L.setOptions(this,this.options),L.Control.Dialog.prototype.initialize.call(this,this.options)},_getTabCount:function(){return this._container.firstChild.firstChild.firstChild.lastChild.childNodes.length},_getTab:function(t){return this._container.firstChild.firstChild.firstChild.lastChild.childNodes[t]},_getTabTitle:function(t){return this._container.firstChild.firstChild.firstChild.getElementsByTagName("UL")[0].childNodes[t]},_getTabContainer:function(t){return this._container.firstChild.firstChild.firstChild.lastChild.childNodes[t].childNodes[0]},_selectTab:function(t){for(var e=this._getTabCount(),i=0;e>i;i++){var n=this._getTab(i),o=this._getTabTitle(i);t!==i?(n.setAttribute("class","dialog-tab"),o.setAttribute("class","dialog-tab-title")):(n.setAttribute("class","dialog-tab selected"),o.setAttribute("class","dialog-tab-title selected-li"))}},onAdd:function(t){this._container=L.Control.Dialog.prototype.onAdd.call(this,t),this._map=t;var e=t.getSize();this.options.size=[Math.floor(.5*e.x),Math.floor(.5*e.y)],this.options.maxSize=[Math.floor(.5*e.x),Math.floor(.5*e.y)],this.options.anchor=[Math.floor(.25*e.x),Math.floor(.25*e.y)],this._isOpen=!1,L.setOptions(this,this.options);var i=this.contents.join("");this.setContent(i);for(var n=function(t){return function(){this._selectTab(t)}},o=this._getTabCount(),s=0;o>s;s++)L.DomEvent.addListener(this._getTabTitle(s),"click",n(s),this);return this._dlgCreateControls(),this.options.initOpen?this.open():this.close(),this._container},close:function(){this._isOpen=!1,L.Control.Dialog.prototype.close.call(this)},open:function(){this._map.fire("close_all_dialogs"),this._isOpen=!0,L.Control.Dialog.prototype.open.call(this)},contents:['<div class="dialog-container">','<ul class="dialog-tabs-title">','<li class="dialog-tab-title selected-li">Save Drawing As</li>',"</ul>",'<div class="dialog-tabs">','<div class="dialog-tab selected"><div class="dialog-tab-content"><h3>Save Drawing As</h3></div></div>',"</div>","</div>",""],saveAsText:function(){var t=this.options.saveALink,e="RSWE.json";this.options.InputName.value&&(e=this.options.InputName.value),t.download=e;var i=this._map.RSWEIndoor.getData();t.href="data:text/plain;base64,"+L.Util.base64Encode(i),t.click(),this.close()},_dlgCreateControls:function(){var t,e;t=this._getTabContainer(0),t&&(e=L.DomUtil.create("div","save-file-name"),t.appendChild(e),e.innerHTML=['<a href="" download="" style="display:none;"></a>','<label><input type="text" name="saveFileName" placeholder="Enter file name"/></label>','&nbsp;<input type="button" value="Save drawing to file"/>','<br><br><i>Your drawing will be saved into system "Download" folder.</i>'].join(""),this.options.saveALink=e.firstChild,this.options.InputName=e.getElementsByTagName("INPUT")[0],this.options.InputButton=e.getElementsByTagName("INPUT")[1],L.DomEvent.addListener(this.options.InputButton,"click",function(){this.saveAsText()},this))}}),L.control.dialog.save=function(t){return new L.Control.Dialog.Save(t)},L.Control.Dialog.Load=L.Control.Dialog.extend({options:{size:[300,300],minSize:[100,100],maxSize:[350,350],anchor:[50,50],position:"topleft",initOpen:!1},msgDiv:{},_isOpen:!1,initialize:function(){L.setOptions(this,this.options),L.Control.Dialog.prototype.initialize.call(this,this.options)},_getTabCount:function(){return this._container.firstChild.firstChild.firstChild.lastChild.childNodes.length},_getTab:function(t){return this._container.firstChild.firstChild.firstChild.lastChild.childNodes[t]},_getTabTitle:function(t){return this._container.firstChild.firstChild.firstChild.getElementsByTagName("UL")[0].childNodes[t]},_getTabContainer:function(t){return this._container.firstChild.firstChild.firstChild.lastChild.childNodes[t].childNodes[0]},_selectTab:function(t){for(var e=this._getTabCount(),i=0;e>i;i++){var n=this._getTab(i),o=this._getTabTitle(i);t!==i?(n.setAttribute("class","dialog-tab"),o.setAttribute("class","dialog-tab-title")):(n.setAttribute("class","dialog-tab selected"),o.setAttribute("class","dialog-tab-title selected-li"))}},onAdd:function(t){this._container=L.Control.Dialog.prototype.onAdd.call(this,t),this._map=t;var e=t.getSize();this.options.size=[Math.floor(.5*e.x),Math.floor(.5*e.y)],this.options.maxSize=[Math.floor(.5*e.x),Math.floor(.5*e.y)],this.options.anchor=[Math.floor(.25*e.x),Math.floor(.25*e.y)],this._isOpen=!1,L.setOptions(this,this.options);var i=this.contents.join("");this.setContent(i);for(var n=function(t){return function(){this._selectTab(t)}},o=this._getTabCount(),s=0;o>s;s++)L.DomEvent.addListener(this._getTabTitle(s),"click",n(s),this);return this._dlgCreateControls(),this.options.initOpen?this.open():this.close(),this._container},close:function(){this.msgDiv.innerHTML="",this._isOpen=!1,L.Control.Dialog.prototype.close.call(this)},open:function(){this._map.fire("close_all_dialogs"),this._isOpen=!0,L.Control.Dialog.prototype.open.call(this)},contents:['<div class="dialog-container">','<ul class="dialog-tabs-title">','<li class="dialog-tab-title selected-li">Load Drawing From File</li>',"</ul>",'<div class="dialog-tabs">','<div class="dialog-tab selected"><div class="dialog-tab-content" ><h3>Load Drawing From File</h3></div></div>',"</div>","</div>",""],_dlgCreateControls:function(){var e,i;e=this._getTabContainer(0),e&&(i=L.DomUtil.create("div","save-file-name"),e.appendChild(i),t.File&&t.FileReader&&t.FileList&&t.Blob?(i.innerHTML=["<div></div>",'<input type="file" name="file" />','<output id="list"></output>'].join(""),this.msgDiv=i.getElementsByTagName("DIV")[0],this.InputName=i.getElementsByTagName("INPUT")[0],L.DomEvent.addListener(this.InputName,"change",function(t){this.handleFileSelect(t)},this)):i.innerHTML=["<div>Sorry. The File APIs are not fully supported in this browser.</div>"].join(""))},handleFileSelect:function(t){var e=t.target.files;if(!e.length)return void(this.msgDiv.innerHTML="Please select a file!");var i=new FileReader;i.thisDlg=this,i.onloadend=function(t){if(t.target.readyState===FileReader.DONE){t.target.thisDlg.InputName.value="";var e=t.target.thisDlg._map.RSWEIndoor.loadData(t.target.result);if(!e)return void(t.target.thisDlg.msgDiv.innerHTML="ERROR loading data!  Please check file contents.");t.target.thisDlg.close()}};var n=e[0].slice(0,e[0].size);i.readAsBinaryString(n)}}),L.control.dialog.load=function(t){return new L.Control.Dialog.Load(t)}}(window,document);